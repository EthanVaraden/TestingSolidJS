var Bi=Object.defineProperty;var Fi=(r,i,e)=>i in r?Bi(r,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[i]=e;var a=(r,i,e)=>Fi(r,typeof i!="symbol"?i+"":i,e);import{T as Pi,g as Ct,a as M,E as Re,b as ae,c as Be,i as Ei,d as Yt,e as Oi,m as We,W as Ee,f as $i,h as ai,j as Di,k as Rt,S as Vt,l as li,B as Yi,n as Wi,o as hi,p as Ui,q as Hi,r as ci,C as Xi,s as Vi,t as jt,u as Gt,v as ji,w as di,R as Gi,x as Ki,y as qi,z as Qi,A as Zi}from"./CoreExtension-UqvKx_PC.js";class V{constructor(i){a(this,"priority",1);a(this,"name","");a(this,"ref");a(this,"target");a(this,"passParameters","");a(this,"declaredUniforms","");a(this,"uniformInfo",{});const{ref:e,target:t,props:s={}}=i;this.ref=e,this.target=t;const o={},n=[];let l="";const h=this.constructor.uniforms||{};for(const d in h){const f=h[d],u=f.type,y="".concat(e,"_").concat(d);let x="";f.size&&(x="[".concat(f.size(s),"]")),n.push(y),l+="uniform ".concat(u," ").concat(y).concat(x,";"),o[d]={name:y,uniform:h[d].method}}this.passParameters=n.join(","),this.declaredUniforms=l,this.uniformInfo=o}static getEffectKey(i){return""}static getMethodParameters(i,e){const t=[];for(const s in i){const o=i[s];let n="";o.size&&(n="[".concat(o.size(e),"]")),t.push("".concat(o.type," ").concat(s).concat(n))}return t.join(",")}static resolveDefaults(i){return{}}static makeEffectKey(i){return!1}}a(V,"uniforms",{}),a(V,"methods"),a(V,"onShaderMask"),a(V,"onColorize"),a(V,"onEffectMask");const Ji={x:(r,i)=>{r.props.x=i},y:(r,i)=>{r.props.y=i},width:(r,i)=>{r.props.width=i},height:(r,i)=>{r.props.height=i},color:(r,i)=>{r.props.color=i},zIndex:(r,i)=>{r.props.zIndex=i},fontFamily:(r,i)=>{r.props.fontFamily=i},fontWeight:(r,i)=>{r.props.fontWeight=i},fontStyle:(r,i)=>{r.props.fontStyle=i},fontStretch:(r,i)=>{r.props.fontStretch=i},fontSize:(r,i)=>{r.props.fontSize=i},text:(r,i)=>{r.props.text=i},textAlign:(r,i)=>{r.props.textAlign=i},contain:(r,i)=>{r.props.contain=i},offsetY:(r,i)=>{r.props.offsetY=i},scrollable:(r,i)=>{r.props.scrollable=i},scrollY:(r,i)=>{r.props.scrollY=i},letterSpacing:(r,i)=>{r.props.letterSpacing=i},lineHeight:(r,i)=>{r.props.lineHeight=i},maxLines:(r,i)=>{r.props.maxLines=i},textBaseline:(r,i)=>{r.props.textBaseline=i},verticalAlign:(r,i)=>{r.props.verticalAlign=i},overflowSuffix:(r,i)=>{r.props.overflowSuffix=i},debug:(r,i)=>{r.props.debug=i}};class ui{constructor(i){a(this,"stage");a(this,"set");this.stage=i;const e={...Ji,...this.getPropertySetters()};this.set=Object.freeze(Object.fromEntries(Object.entries(e).map(([t,s])=>[t,(o,n)=>{o.props[t]!==n&&(s(o,n),this.stage.requestRender())}])))}setStatus(i,e,t){i.status!==e&&(i.status=e,i.emitter.emit(e,t))}setIsRenderable(i,e){i.isRenderable=e}destroyState(i){["loading","loaded","failed"].forEach(t=>{i.emitter.off(t)})}scheduleUpdateState(i){i.updateScheduled||(i.updateScheduled=!0,queueMicrotask(()=>{i.updateScheduled=!1,this.updateState(i)}))}}class Kt extends Pi{constructor(e,t,s){super(e,t);a(this,"fontFace");a(this,"fontUrl");const o=s.replace(/\(|\)/g,""),n=this.descriptors,l={style:n.style,weight:typeof n.weight=="number"?"".concat(n.weight):n.weight,stretch:n.stretch,unicodeRange:n.unicodeRange,variant:n.variant,featureSettings:n.featureSettings,display:n.display},h=new FontFace(e,"url(".concat(o,")"),l);h.load().then(()=>{this.loaded=!0,this.emit("loaded")}).catch(console.error),this.fontFace=h,this.fontUrl=s}}const qt=2048;function Qt(r,i,e,t,s){const o=r!=="bottom"?.5*i:0;return e*(t-1)+o+Math.max(e,i)+(s||0)}class es{constructor(i,e){a(this,"_canvas");a(this,"_context");a(this,"_settings");a(this,"renderInfo");this._canvas=i,this._context=e,this._settings=this.mergeDefaults({})}set settings(i){this._settings=this.mergeDefaults(i)}get settings(){return this._settings}getPrecision(){return this._settings.precision}setFontProperties(){this._context.font=this._getFontSetting(),this._context.textBaseline=this._settings.textBaseline}_getFontSetting(){const i=[this._settings.fontFace],e=[];for(let t=0,s=i.length;t<s;t++)i[t]==="serif"||i[t]==="sans-serif"?e.push(i[t]):e.push('"'.concat(i[t],'"'));return"".concat(this._settings.fontStyle," ").concat(this._settings.fontSize*this.getPrecision(),"px ").concat(e.join(","))}_load(){if(document.fonts){const i=this._getFontSetting();try{if(!document.fonts.check(i,this._settings.text))return document.fonts.load(i,this._settings.text).catch(e=>{console.warn("[Lightning] Font load error",e,i)}).then(()=>{document.fonts.check(i,this._settings.text)||console.warn("[Lightning] Font not found",i)})}catch(e){console.warn("[Lightning] Can't check font loading for "+i)}}}calculateRenderInfo(){const i={},e=this.getPrecision(),t=this._settings.paddingLeft*e,s=this._settings.paddingRight*e,o=this._settings.fontSize*e;let n=this._settings.offsetY===null?null:this._settings.offsetY*e,l=(this._settings.lineHeight||o)*e;const h=this._settings.w*e,d=this._settings.h*e;let f=this._settings.wordWrapWidth*e;const u=this._settings.cutSx*e,y=this._settings.cutEx*e,x=this._settings.cutSy*e,w=this._settings.cutEy*e,_=(this._settings.letterSpacing||0)*e,m=this._settings.textIndent*e;this.setFontProperties();let R=h||2048/this.getPrecision(),g=R-t;if(g<10&&(R+=10-g,g=10),f||(f=g),this._settings.textOverflow&&!this._settings.wordWrap){let S;switch(this._settings.textOverflow){case"clip":S="";break;case"ellipsis":S=this._settings.overflowSuffix;break;default:S=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,f-m,S)}let p;if(this._settings.wordWrap)p=this.wrapText(this._settings.text,f,_,m);else{p={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]};const S=p.l.length;for(let T=0;T<S-1;T++)p.n.push(T)}let c=p.l;if(this._settings.maxLines&&c.length>this._settings.maxLines){const S=c.slice(0,this._settings.maxLines);let T=null;if(this._settings.overflowSuffix){const z=this._settings.overflowSuffix?this.measureText(this._settings.overflowSuffix):0,N=this.wrapText(S[S.length-1],f-z,_,m);S[S.length-1]="".concat(N.l[0]).concat(this._settings.overflowSuffix),T=[N.l.length>1?N.l[1]:""]}else T=[""];let k;const L=c.length;let A=0;const F=p.n.length;for(k=this._settings.maxLines;k<L;k++)T[A]+="".concat(T[A]?" ":"").concat(c[k]),k+1<F&&p.n[k+1]&&A++;i.remainingText=T.join("\n"),i.moreTextLines=!0,c=S}else i.moreTextLines=!1,i.remainingText="";let v=0;const I=[];for(let S=0;S<c.length;S++){const T=this.measureText(c[S],_)+(S===0?m:0);I.push(T),v=Math.max(v,T)}i.lineWidths=I,h||(R=v+t+s,g=v),l=l||o;let b;return d?b=d:b=Qt(this._settings.textBaseline,o,l,c.length,n),n===null&&(n=o),i.w=R,i.h=b,i.lines=c,i.precision=e,R||(R=1),b||(b=1),(u||y)&&(R=Math.min(R,y-u)),(x||w)&&(b=Math.min(b,w-x)),i.width=R,i.innerWidth=g,i.height=b,i.fontSize=o,i.cutSx=u,i.cutSy=x,i.cutEx=y,i.cutEy=w,i.lineHeight=l,i.lineWidths=I,i.offsetY=n,i.paddingLeft=t,i.paddingRight=s,i.letterSpacing=_,i.textIndent=m,i}draw(i,e){const t=this.getPrecision(),s=(e==null?void 0:e.lines)||i.lines,o=(e==null?void 0:e.lineWidths)||i.lineWidths,n=e?Qt(this._settings.textBaseline,i.fontSize,i.lineHeight,e.lines.length,this._settings.offsetY===null?null:this._settings.offsetY*t):i.height;this._canvas.width=Math.min(Math.ceil(i.width+this._settings.textRenderIssueMargin),qt),this._canvas.height=Math.min(Math.ceil(n),qt),this.setFontProperties(),i.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(i.cutSx||i.cutSy)&&this._context.translate(-i.cutSx,-i.cutSy);let l,h;const d=[];for(let u=0,y=s.length;u<y;u++)l=u===0?i.textIndent:0,h=u*i.lineHeight+i.offsetY,this._settings.verticalAlign=="middle"?h+=(i.lineHeight-i.fontSize)/2:this._settings.verticalAlign=="bottom"&&(h+=i.lineHeight-i.fontSize),this._settings.textAlign==="right"?l+=i.innerWidth-o[u]:this._settings.textAlign==="center"&&(l+=(i.innerWidth-o[u])/2),l+=i.paddingLeft,d.push({text:s[u],x:l,y:h,w:o[u]});if(this._settings.highlight){const u=this._settings.highlightColor,y=this._settings.highlightHeight*t||i.fontSize*1.5,x=this._settings.highlightOffset*t,w=this._settings.highlightPaddingLeft!==null?this._settings.highlightPaddingLeft*t:i.paddingLeft,_=this._settings.highlightPaddingRight!==null?this._settings.highlightPaddingRight*t:i.paddingRight;this._context.fillStyle=Ct(u);for(let m=0;m<d.length;m++){const R=d[m];this._context.fillRect(R.x-w,R.y-i.offsetY+x,R.w+_+w,y)}}let f=null;this._settings.shadow&&(f=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=Ct(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*t,this._context.shadowOffsetY=this._settings.shadowOffsetY*t,this._context.shadowBlur=this._settings.shadowBlur*t),this._context.fillStyle=Ct(this._settings.textColor);for(let u=0,y=d.length;u<y;u++){const x=d[u];if(i.letterSpacing===0)this._context.fillText(x.text,x.x,x.y);else{const w=x.text.split("");let _=x.x;for(let m=0,R=w.length;m<R;m++)this._context.fillText(w[m],_,x.y),_+=this.measureText(w[m],i.letterSpacing)}}f&&(this._context.shadowColor=f[0],this._context.shadowOffsetX=f[1],this._context.shadowOffsetY=f[2],this._context.shadowBlur=f[3]),(i.cutSx||i.cutSy)&&this._context.translate(i.cutSx,i.cutSy),this.renderInfo=i}wrapWord(i,e,t){const s=this._context.measureText(t).width,o=i.length,n=this._context.measureText(i).width;if(n<=e)return i;let l=Math.floor(e*o/n),h=this._context.measureText(i.substring(0,l)).width+s;if(h>e)for(;l>0&&(h=this._context.measureText(i.substring(0,l)).width+s,h>e);)l-=1;else for(;l<o;)if(h=this._context.measureText(i.substring(0,l)).width+s,h<e)l+=1;else{l-=1;break}return i.substring(0,l)+(e>=s?t:"")}wrapText(i,e,t,s=0){const o=i.split(/\r?\n/g);let n=[];const l=[];for(let h=0;h<o.length;h++){const d=[];let f="",u=e-s;const y=o[h].split(" ");for(let x=0;x<y.length;x++){const w=this.measureText(y[x],t),_=w+this.measureText(" ",t);x===0||_>u?(x>0&&(d.push(f),f=""),f+=y[x],u=e-w-(x===0?s:0)):(u-=_,f+=" ".concat(y[x]))}d.push(f),f="",n=n.concat(d),h<o.length-1&&l.push(n.length)}return{l:n,n:l}}measureText(i,e=0){return e?i.split("").reduce((t,s)=>t+this._context.measureText(s).width+e,0):this._context.measureText(i).width}mergeDefaults(i){return{text:"",w:0,h:0,fontStyle:"normal",fontSize:40,fontFace:null,wordWrap:!0,wordWrapWidth:0,wordBreak:!1,textOverflow:"",lineHeight:null,textBaseline:"alphabetic",textAlign:"left",verticalAlign:"top",offsetY:null,maxLines:0,overflowSuffix:"...",textColor:[1,1,1,1],paddingLeft:0,paddingRight:0,shadow:!1,shadowColor:[0,0,0,1],shadowOffsetX:0,shadowOffsetY:0,shadowBlur:5,highlight:!1,highlightHeight:0,highlightColor:[0,0,0,1],highlightOffset:0,highlightPaddingLeft:0,highlightPaddingRight:0,letterSpacing:0,textIndent:0,cutSx:0,cutEx:0,cutSy:0,cutEy:0,advancedRenderer:!1,fontBaselineRatio:0,precision:1,textRenderIssueMargin:0,...i}}}const Zt=typeof self>"u"?globalThis:self;var ni;const Jt=((ni=Zt.document)==null?void 0:ni.fonts)||Zt.fonts;function ts(r){const{fontFamily:i,fontStyle:e,fontWeight:t,fontStretch:s,fontSize:o}=r;return[e,t,s,"".concat(o,"px"),i].join(" ")}const is=Be(0,0,0,0);class ei extends ui{constructor(e){super(e);a(this,"canvas");a(this,"context");a(this,"rendererBounds");typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(0,0):this.canvas=document.createElement("canvas");let t=this.canvas.getContext("2d");t||(this.canvas=document.createElement("canvas"),t=this.canvas.getContext("2d")),M(t),this.context=t,this.rendererBounds={x1:0,y1:0,x2:this.stage.options.appWidth,y2:this.stage.options.appHeight}}getPropertySetters(){return{fontFamily:(e,t)=>{e.props.fontFamily=t,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontWeight:(e,t)=>{e.props.fontWeight=t,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontStyle:(e,t)=>{e.props.fontStyle=t,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontStretch:(e,t)=>{e.props.fontStretch=t,e.fontInfo=void 0,this.invalidateLayoutCache(e)},fontSize:(e,t)=>{e.props.fontSize=t,e.fontInfo=void 0,this.invalidateLayoutCache(e)},text:(e,t)=>{e.props.text=t,this.invalidateLayoutCache(e)},textAlign:(e,t)=>{e.props.textAlign=t,this.invalidateLayoutCache(e)},color:(e,t)=>{e.props.color=t,this.invalidateLayoutCache(e)},x:(e,t)=>{e.props.x=t,this.invalidateVisibleWindowCache(e)},y:(e,t)=>{e.props.y=t,this.invalidateVisibleWindowCache(e)},contain:(e,t)=>{e.props.contain=t,this.invalidateLayoutCache(e)},width:(e,t)=>{e.props.width=t,e.props.contain!=="none"&&this.invalidateLayoutCache(e)},height:(e,t)=>{e.props.height=t,e.props.contain==="both"&&this.invalidateLayoutCache(e)},offsetY:(e,t)=>{e.props.offsetY=t,this.invalidateLayoutCache(e)},scrollY:(e,t)=>{e.props.scrollY=t},letterSpacing:(e,t)=>{e.props.letterSpacing=t,this.invalidateLayoutCache(e)},lineHeight:(e,t)=>{e.props.lineHeight=t,this.invalidateLayoutCache(e)},maxLines:(e,t)=>{e.props.maxLines=t,this.invalidateLayoutCache(e)},textBaseline:(e,t)=>{e.props.textBaseline=t,this.invalidateLayoutCache(e)},verticalAlign:(e,t)=>{e.props.verticalAlign=t,this.invalidateLayoutCache(e)},overflowSuffix:(e,t)=>{e.props.overflowSuffix=t,this.invalidateLayoutCache(e)}}}canRenderFont(e){return!0}isFontFaceSupported(e){return e instanceof Kt}addFontFace(e){M(e instanceof Kt),Jt.add(e.fontFace)}createState(e){return{props:e,status:"initialState",updateScheduled:!1,emitter:new Re,canvasPages:void 0,lightning2TextRenderer:new es(this.canvas,this.context),renderWindow:void 0,visibleWindow:{x1:0,y1:0,x2:0,y2:0,valid:!1},renderInfo:void 0,forceFullLayoutCalc:!1,textW:0,textH:0,fontInfo:void 0,fontFaceLoadedHandler:void 0,isRenderable:!1,debugData:{updateCount:0,layoutCount:0,drawCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,bufferSize:0}}}updateState(e){var w,_;if(e.status==="initialState"&&this.setStatus(e,"loading"),!e.fontInfo){const m=ts(e.props);if(e.fontInfo={cssString:m,loaded:!1},!e.fontInfo.loaded){Jt.load(m).then(this.onFontLoaded.bind(this,e,m)).catch(this.onFontLoadError.bind(this,e,m));return}}if(!e.fontInfo.loaded)return;if(!e.renderInfo){const m=e.props.maxLines,R=e.props.contain==="both"?Math.floor((e.props.height-e.props.offsetY)/e.props.lineHeight):0,g=R>0&&m>0?Math.min(R,m):Math.max(R,m);e.lightning2TextRenderer.settings={text:e.props.text,textAlign:e.props.textAlign,fontFace:e.props.fontFamily,fontSize:e.props.fontSize,fontStyle:[e.props.fontStretch,e.props.fontStyle,e.props.fontWeight].join(" "),textColor:ae(e.props.color),offsetY:e.props.fontSize+e.props.offsetY,wordWrap:e.props.contain!=="none",wordWrapWidth:e.props.contain==="none"?void 0:e.props.width,letterSpacing:e.props.letterSpacing,lineHeight:e.props.lineHeight,maxLines:g,textBaseline:e.props.textBaseline,verticalAlign:e.props.verticalAlign,overflowSuffix:e.props.overflowSuffix},e.renderInfo=e.lightning2TextRenderer.calculateRenderInfo(),e.textH=e.renderInfo.lineHeight*e.renderInfo.lines.length,e.textW=e.renderInfo.width,e.renderWindow=void 0}const{x:t,y:s,width:o,height:n,scrollY:l,contain:h}=e.props,{visibleWindow:d}=e;let{renderWindow:f,canvasPages:u}=e;if(!d.valid){const m=Be(t,s,h!=="none"?t+o:1/0,h==="both"?s+n:1/0,is);Ei(this.rendererBounds,m,d),d.valid=!0}const y=d.y2-d.y1,x=Math.ceil(y/e.renderInfo.lineHeight);if(y===0){u=void 0,f=void 0,this.setStatus(e,"loaded");return}else if(f&&u){const m=t+f.x1,R=s-l+f.y1,g=t+f.x2,p=s-l+f.y2;if(m<=d.x1&&g>=d.x2&&R<=d.y1&&p>=d.y2){this.setStatus(e,"loaded");return}p<d.y2?(f.y1+=x*e.renderInfo.lineHeight,f.y2+=x*e.renderInfo.lineHeight,u.push(u.shift()),u[2].lineNumStart=u[1].lineNumStart+x,u[2].lineNumEnd=u[2].lineNumStart+x,u[2].valid=!1):R>d.y1&&(f.y1-=x*e.renderInfo.lineHeight,f.y2-=x*e.renderInfo.lineHeight,u.unshift(u.pop()),u[0].lineNumStart=u[1].lineNumStart-x,u[0].lineNumEnd=u[0].lineNumStart+x,u[0].valid=!1)}else{const m=e.renderInfo.lineHeight*x,R=Math.ceil(l/m),g=R*x,p=g-x,c=g+x;u=[{texture:u==null?void 0:u[0].texture,lineNumStart:p,lineNumEnd:p+x,valid:!1},{texture:u==null?void 0:u[1].texture,lineNumStart:g,lineNumEnd:g+x,valid:!1},{texture:u==null?void 0:u[2].texture,lineNumStart:c,lineNumEnd:c+x,valid:!1}],e.canvasPages=u;const v=R*m;f={x1:0,y1:v-m,x2:o,y2:v+m*2}}e.renderWindow=f,performance.now();for(const m of u)if(!m.valid){if(m.lineNumStart<0){(w=m.texture)==null||w.setRenderableOwner(e,!1),m.texture=this.stage.txManager.loadTexture("ImageTexture",{src:""}),m.texture.setRenderableOwner(e,e.isRenderable),m.valid=!0;continue}e.lightning2TextRenderer.draw(e.renderInfo,{lines:e.renderInfo.lines.slice(m.lineNumStart,m.lineNumEnd),lineWidths:e.renderInfo.lineWidths.slice(m.lineNumStart,m.lineNumEnd)}),this.canvas.width===0||this.canvas.height===0||((_=m.texture)==null||_.setRenderableOwner(e,!1),m.texture=this.stage.txManager.loadTexture("ImageTexture",{src:this.context.getImageData(0,0,this.canvas.width,this.canvas.height)},{preload:!0}),m.texture.setRenderableOwner(e,e.isRenderable)),m.valid=!0}this.setStatus(e,"loaded")}renderQuads(e,t,s,o){var S,T,k,L,A,F,z,N,B,D,se,oe;const{stage:n}=this,{canvasPages:l,textW:h=0,textH:d=0,renderWindow:f}=e;if(!l||!f)return;const{x:u,y,scrollY:x,contain:w,width:_,height:m}=e.props,R={x:u,y,width:w!=="none"?_:h,height:w==="both"?m:d};Yt({x:0,y:0,width:n.options.appWidth,height:n.options.appHeight},R),M(l,"canvasPages is not defined"),M(f,"renderWindow is not defined");const p=(f.y2-f.y1)/3,{zIndex:c,color:v}=e.props,I=o*Oi(v),b=We(4294967295,I);l[0].valid&&this.stage.renderer.addQuad({alpha:I,clippingRect:s,colorBl:b,colorBr:b,colorTl:b,colorTr:b,width:((T=(S=l[0].texture)==null?void 0:S.dimensions)==null?void 0:T.width)||0,height:((L=(k=l[0].texture)==null?void 0:k.dimensions)==null?void 0:L.height)||0,texture:l[0].texture,textureOptions:{},shader:null,shaderProps:null,zIndex:c,tx:t.tx,ty:t.ty-x+f.y1,ta:t.ta,tb:t.tb,tc:t.tc,td:t.td}),l[1].valid&&this.stage.renderer.addQuad({alpha:I,clippingRect:s,colorBl:b,colorBr:b,colorTl:b,colorTr:b,width:((F=(A=l[1].texture)==null?void 0:A.dimensions)==null?void 0:F.width)||0,height:((N=(z=l[1].texture)==null?void 0:z.dimensions)==null?void 0:N.height)||0,texture:l[1].texture,textureOptions:{},shader:null,shaderProps:null,zIndex:c,tx:t.tx,ty:t.ty-x+f.y1+p,ta:t.ta,tb:t.tb,tc:t.tc,td:t.td}),l[2].valid&&this.stage.renderer.addQuad({alpha:I,clippingRect:s,colorBl:b,colorBr:b,colorTl:b,colorTr:b,width:((D=(B=l[2].texture)==null?void 0:B.dimensions)==null?void 0:D.width)||0,height:((oe=(se=l[2].texture)==null?void 0:se.dimensions)==null?void 0:oe.height)||0,texture:l[2].texture,textureOptions:{},shader:null,shaderProps:null,zIndex:c,tx:t.tx,ty:t.ty-x+f.y1+p+p,ta:t.ta,tb:t.tb,tc:t.tc,td:t.td})}setIsRenderable(e,t){var s;super.setIsRenderable(e,t),(s=e.canvasPages)==null||s.forEach(o=>{var n;(n=o.texture)==null||n.setRenderableOwner(e,t)})}destroyState(e){var t;(t=e.canvasPages)==null||t.forEach(s=>{var o;(o=s.texture)==null||o.setRenderableOwner(e,!1)})}invalidateVisibleWindowCache(e){e.visibleWindow.valid=!1,this.setStatus(e,"loading"),this.scheduleUpdateState(e)}invalidateLayoutCache(e){e.renderInfo=void 0,e.visibleWindow.valid=!1,this.setStatus(e,"loading"),this.scheduleUpdateState(e)}onFontLoaded(e,t){var s;t!==((s=e.fontInfo)==null?void 0:s.cssString)||!e.fontInfo||(e.fontInfo.loaded=!0,this.scheduleUpdateState(e))}onFontLoadError(e,t,s){var o;t!==((o=e.fontInfo)==null?void 0:o.cssString)||!e.fontInfo||(e.fontInfo.loaded=!0,console.error("CanvasTextRenderer: Error loading font '".concat(e.fontInfo.cssString,"'"),s),this.scheduleUpdateState(e))}}class fi extends Ee{constructor(i){super({renderer:i,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"}]})}bindTextures(i){const{glw:e}=this;e.activeTexture(0),e.bindTexture(i[0].ctxTexture)}}a(fi,"shaderSources",{vertex:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio;\n        vec2 screenSpace = vec2(2.0 / u_resolution.x, -2.0 / u_resolution.y);\n\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        gl_Position = vec4(normalized.x * screenSpace.x - 1.0, normalized.y * -abs(screenSpace.y) + 1.0, 0.0, 1.0);\n        gl_Position.y = -sign(screenSpace.y) * gl_Position.y;\n      }\n    ",fragment:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n          vec4 color = texture2D(u_texture, v_textureCoordinate);\n          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);\n      }\n    "});class pi extends Ee{constructor(e){super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color","a_textureIndex"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_textures[0]",uniform:"uniform1iv"}]});a(this,"supportsIndexedTextures",!0)}bindTextures(e){const{renderer:t,glw:s}=this;if(e.length>t.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS)throw new Error("DefaultShaderBatched: Cannot bind more than ".concat(t.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS," textures"));e.forEach((n,l)=>{s.activeTexture(l),s.bindTexture(n.ctxTexture)});const o=Array.from(Array(e.length).keys());this.setUniform("u_textures[0]",o)}}a(pi,"shaderSources",{vertex:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_textureCoordinate;\n      attribute vec2 a_position;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      void main(){\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_textureIndex = a_textureIndex;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",fragment:e=>"\n      #define txUnits ".concat(e,"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_image;\n      uniform sampler2D u_textures[txUnits];\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      vec4 sampleFromTexture(sampler2D textures[").concat(e,"], int idx, vec2 uv) {\n        ").concat(Array.from(Array(e).keys()).map(t=>"\n          ".concat(t!==0?"else ":"","if (idx == ").concat(t,") {\n            return texture2D(textures[").concat(t,"], uv);\n          }\n        ")).join(""),"\n        return texture2D(textures[0], uv);\n      }\n\n      void main(){\n        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);\n      }\n    ")});function gi(r,i){var e=0,t,s;i=i||{};function o(){var n=t,l=arguments.length,h,d;e:for(;n;){if(n.args.length!==arguments.length){n=n.next;continue}for(d=0;d<l;d++)if(n.args[d]!==arguments[d]){n=n.next;continue e}return n!==t&&(n===s&&(s=n.prev),n.prev.next=n.next,n.next&&(n.next.prev=n.prev),n.next=t,n.prev=null,t.prev=n,t=n),n.val}for(h=new Array(l),d=0;d<l;d++)h[d]=arguments[d];return n={args:h,val:r.apply(null,h)},t?(t.prev=n,n.next=t):s=n,e===i.maxSize?(s=s.prev,s.next=null):e++,t=n,n.val}return o.clear=function(){t=null,s=null,e=0},o}const It=new Map,ss=(r,i)=>{const e=JSON.stringify(r);if(It.has(e))return It.get(e);const t=(r!=null?r:[]).map(s=>({type:s.type,props:i[s.type].resolveDefaults(s.props||{})}));return It.set(e,t),t},le=class le extends Ee{constructor(e,t,s){const o=le.createShader(t,s);super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_alpha",uniform:"uniform1f"},...o.uniforms],shaderSources:{vertex:o.vertex,fragment:o.fragment}});a(this,"effects",[]);this.effects=o.effects,this.calculateProps=gi(this.calculateProps.bind(this))}bindTextures(e){const{glw:t}=this;t.activeTexture(0),t.bindTexture(e[0].ctxTexture)}calculateProps(e){const t=this.renderer.shManager.getRegisteredEffects(),s=[];return e==null||e.forEach((o,n)=>{var u;const l=this.effects[n],h=t[l.name],d=(u=o.props)!=null?u:{},f=l.uniformInfo;Object.keys(d).forEach(y=>{const x=h.uniforms[y],w=f[y];let _=x.validator?x.validator(d[y],d):d[y];Array.isArray(_)&&(_=new Float32Array(_)),s.push({name:w.name,value:_})})}),s}bindProps(e){this.calculateProps(e.effects).forEach(s=>{this.setUniform(s.name,s.value)})}canBatchShaderProps(e,t){if(e.$dimensions.width!==t.$dimensions.width||e.$dimensions.height!==t.$dimensions.height||e.effects.length!==t.effects.length)return!1;const s=e.effects.length;let o=0;for(;o<s;o++){const n=e.effects[o],l=t.effects[o];if(n.type!==l.type)return!1;for(const h in n.props)if(l.props&&!l.props[h]||n.props[h]!==l.props[h])return!1}return!0}static createShader(e,t){const s={},o={};let n="";const l=[],h=[],d=e.effects.map(w=>{const _=t[w.type],m=_.getEffectKey(w.props||{});s[m]=s[m]?++s[m]:1;const R=s[m];R===1&&h.push({key:m,type:w.type,props:w.props});const g=new _({ref:"".concat(m).concat(R===1?"":R),target:m,props:w.props});return n+=g.declaredUniforms,l.push(...Object.values(g.uniformInfo)),g});let f="";h==null||h.forEach(w=>{var b;const _=t[w.type],m=_.resolveDefaults((b=w.props)!=null?b:{}),R=[];for(const S in _.methods){let T=S;const k=_.methods[S];o[S]&&o[S]!==k&&(T=le.resolveMethodDuplicate(S,k,o)),o[T]=k.replace("function",T),R.push({m:S,cm:T})}let g=_.onShaderMask instanceof Function?_.onShaderMask(m):_.onShaderMask,p=_.onColorize instanceof Function?_.onColorize(m):_.onColorize,c=_.onEffectMask instanceof Function?_.onEffectMask(m):_.onEffectMask;R.forEach(S=>{const{m:T,cm:k}=S,L=new RegExp("\\$".concat(T),"g");g&&(g=g.replace(L,k)),p&&(p=p.replace(L,k)),c&&(c=c.replace(L,k))});const v=_.getMethodParameters(_.uniforms,m),I=v.length>0?", ".concat(v):"";g&&(f+="\n        float fx_".concat(w.key,"_onShaderMask(float shaderMask ").concat(I,") {\n          ").concat(g,"\n        }\n        ")),p&&(f+="\n          vec4 fx_".concat(w.key,"_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor").concat(I,") {\n            ").concat(p,"\n          }\n        ")),c&&(f+="\n          vec4 fx_".concat(w.key,"_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor").concat(I,") {\n            ").concat(c,"\n          }\n        "))});let u="";for(const w in o)u+=o[w];let y="mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))",x="\n\n    ";for(let w=0;w<d.length;w++){const _=d[w],m=_.passParameters.length>0?", ".concat(_.passParameters):"",R=t[_.name];R.onShaderMask&&(x+="\n        shaderMask = fx_".concat(_.target,"_onShaderMask(shaderMask ").concat(m,");\n        ")),R.onColorize&&(x+="\n        maskColor = fx_".concat(_.target,"_onColorize(shaderMask, maskColor, shaderColor").concat(m,");\n        ")),R.onEffectMask&&(y="fx_".concat(_.target,"_onEffectMask(shaderMask, maskColor, shaderColor").concat(m,")"));const g=d[w+1];(g===void 0||t[g.name].onEffectMask)&&(x+="\n          shaderColor = ".concat(y,";\n        "))}return{effects:d,uniforms:l,fragment:le.fragment(n,u,f,x),vertex:le.vertex()}}static resolveMethodDuplicate(e,t,s,o=0){const n=e+(o>0?o:"");return s[n]&&s[n]!==t?this.resolveMethodDuplicate(e,t,s,++o):n}static resolveDefaults(e,t){return{effects:ss(e.effects,t),$dimensions:{width:0,height:0},$alpha:0}}static makeCacheKey(e,t){var o;let s="";return(o=e.effects)==null||o.forEach(n=>{const h=t[n.type].getEffectKey(n.props||{});s+=",".concat(h)}),"DynamicShader".concat(s)}};a(le,"z$__type__Props"),a(le,"vertex",()=>"\n    # ifdef GL_FRAGMENT_PRESICISON_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    attribute vec2 a_textureCoordinate;\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    attribute float a_textureIndex;\n\n    uniform vec2 u_resolution;\n    uniform float u_pixelRatio;\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n    varying float v_textureIndex;\n\n    void main(){\n      vec2 normalized = a_position * u_pixelRatio / u_resolution;\n      vec2 zero_two = normalized * 2.0;\n      vec2 clip_space = zero_two - 1.0;\n\n      // pass to fragment\n      v_color = a_color;\n      v_textureCoordinate = a_textureCoordinate;\n      v_textureIndex = a_textureIndex;\n\n      // flip y\n      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n    }\n  "),a(le,"fragment",(e,t,s,o)=>"\n    # ifdef GL_FRAGMENT_PRESICISON_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    #define PI 3.14159265359\n\n    uniform vec2 u_resolution;\n    uniform vec2 u_dimensions;\n    uniform float u_alpha;\n    uniform float u_radius;\n    uniform sampler2D u_texture;\n    uniform float u_pixelRatio;\n\n    ".concat(e,"\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n\n    ").concat(t,"\n\n    ").concat(s,"\n\n    void main() {\n      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;\n      vec2 d = abs(p) - (u_dimensions) * 0.5;\n      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n\n      vec4 shaderColor = vec4(0.0);\n      float shaderMask = lng_DefaultMask;\n\n      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;\n\n      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));\n\n      ").concat(o,"\n\n      gl_FragColor = shaderColor * u_alpha;\n    }\n  "));let Fe=le;class At extends Ee{constructor(i){super({renderer:i,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_radius",uniform:"uniform1f"}]})}static resolveDefaults(i){return{radius:i.radius||10,$dimensions:{width:0,height:0}}}bindTextures(i){const{glw:e}=this;e.activeTexture(0),e.bindTexture(i[0].ctxTexture)}bindProps(i){this.setUniform("u_radius",i.radius)}canBatchShaderProps(i,e){return i.radius===e.radius&&i.$dimensions.width===e.$dimensions.width&&i.$dimensions.height===e.$dimensions.height}}a(At,"z$__type__Props"),a(At,"shaderSources",{vertex:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",fragment:"\n      # ifdef GL_FRAGMENT_PRESICISON_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform vec2 u_dimensions;\n      uniform float u_radius;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n\n      float fillMask(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n\n      void main() {\n        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;\n        vec2 halfDimensions = u_dimensions * 0.5;\n\n        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);\n        gl_FragColor = mix(vec4(0.0), color, fillMask(d));\n      }\n    "});const rs=new Float32Array([1,0,0,0,1,0,0,0,1]),_t=class _t extends Ee{constructor(i){super({renderer:i,attributes:["a_position","a_textureCoordinate"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_transform",uniform:"uniformMatrix3fv"},{name:"u_scrollY",uniform:"uniform1f"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_color",uniform:"uniform4fv"},{name:"u_size",uniform:"uniform1f"},{name:"u_distanceRange",uniform:"uniform1f"},{name:"u_debug",uniform:"uniform1i"}]})}bindTextures(i){const{glw:e}=this;e.activeTexture(0),e.bindTexture(i[0].ctxTexture)}bindProps(i){const e=_t.resolveDefaults(i);for(const t in e)if(t==="transform")this.setUniform("u_transform",!1,e[t]);else if(t==="scrollY")this.setUniform("u_scrollY",e[t]);else if(t==="color"){const s=ae(e.color);this.setUniform("u_color",s)}else t==="size"?this.setUniform("u_size",e[t]):t==="distanceRange"?this.setUniform("u_distanceRange",e[t]):t==="debug"&&this.setUniform("u_debug",e[t]?1:0)}static resolveDefaults(i={}){var e,t,s,o,n,l;return{transform:(e=i.transform)!=null?e:rs,scrollY:(t=i.scrollY)!=null?t:0,color:(s=i.color)!=null?s:4294967295,size:(o=i.size)!=null?o:16,distanceRange:(n=i.distanceRange)!=null?n:1,debug:(l=i.debug)!=null?l:!1}}};a(_t,"shaderSources",{vertex:"\n      // an attribute is an input (in) to a vertex shader.\n      // It will receive data from a buffer\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n\n      uniform vec2 u_resolution;\n      uniform mat3 u_transform;\n      uniform float u_scrollY;\n      uniform float u_pixelRatio;\n      uniform float u_size;\n\n      varying vec2 v_texcoord;\n\n      void main() {\n        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);\n        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;\n\n        // Calculate screen space with pixel ratio\n        vec2 screenSpace = (transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1);\n\n        gl_Position = vec4(screenSpace, 0.0, 1.0);\n        v_texcoord = a_textureCoordinate;\n\n      }\n    ",fragment:"\n      precision highp float;\n\n      uniform vec4 u_color;\n      uniform sampler2D u_texture;\n      uniform float u_distanceRange;\n      uniform float u_pixelRatio;\n      uniform int u_debug;\n\n      varying vec2 v_texcoord;\n\n      float median(float r, float g, float b) {\n          return max(min(r, g), min(max(r, g), b));\n      }\n\n      void main() {\n          vec3 sample = texture2D(u_texture, v_texcoord).rgb;\n          if (u_debug == 1) {\n            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);\n            return;\n          }\n          float scaledDistRange = u_distanceRange * u_pixelRatio;\n          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);\n          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;\n\n          // Build the final color.\n          // IMPORTANT: We must premultiply the color by the alpha value before returning it.\n          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);\n      }\n    "});let zt=_t;class Ie extends V{constructor(){super(...arguments);a(this,"name","radius")}static getEffectKey(){return"radius"}static resolveDefaults(e){var t;return{radius:(t=e.radius)!=null?t:10}}}a(Ie,"z$__type__Props"),a(Ie,"uniforms",{radius:{value:0,method:"uniform4fv",type:"vec4",validator:e=>{let t=e;return Array.isArray(t)?t.length===2?t=[t[0],t[1],t[0],t[1]]:t.length===3?t=[t[0],t[1],t[2],t[0]]:t.length!==4&&(t=[t[0],t[0],t[0],t[0]]):typeof t=="number"&&(t=[t,t,t,t]),t}}}),a(Ie,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",boxDist:"\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    "}),a(Ie,"onShaderMask","\n  vec2 halfDimensions = u_dimensions * 0.5;\n  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);\n  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);\n  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);\n  "),a(Ie,"onEffectMask","\n  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));\n  ");class Ue extends V{constructor(){super(...arguments);a(this,"name","border")}static getEffectKey(){return"border"}static resolveDefaults(e){var t,s;return{width:(t=e.width)!=null?t:10,color:(s=e.color)!=null?s:4294967295}}}a(Ue,"z$__type__Props"),a(Ue,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:e=>ae(e),method:"uniform4fv",type:"vec4"}}),a(Ue,"onEffectMask","\n  float mask = clamp(shaderMask + width, 0.0, 1.0) - clamp(shaderMask, 0.0, 1.0);\n  return mix(shaderColor, mix(shaderColor, maskColor, maskColor.a), mask);\n  "),a(Ue,"onColorize","\n    return color;\n  ");const xe=class xe extends V{constructor(){super(...arguments);a(this,"name","linearGradient")}static getEffectKey(e){return"linearGradient".concat(e.colors.length)}static resolveDefaults(e){var o,n;const t=(o=e.colors)!=null?o:[4278190080,4294967295];let s=e.stops||[];if(s.length===0||s.length!==t.length){const l=t.length;let h=0;const d=s;for(;h<l;h++)s[h]?(d[h]=s[h],s[h-1]===void 0&&d[h-2]!==void 0&&(d[h-1]=d[h-2]+(s[h]-d[h-2])/2)):d[h]=h*(1/(t.length-1));s=d}return{colors:t,stops:s,angle:(n=e.angle)!=null?n:0}}};a(xe,"z$__type__Props"),a(xe,"uniforms",{angle:{value:0,method:"uniform1f",type:"float"},colors:{value:4294967295,validator:e=>e.map(s=>ae(s)).reduce((s,o)=>s.concat(o),[]),size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),a(xe,"methods",{fromLinear:"\n      vec4 function(vec4 linearRGB) {\n        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);\n        vec4 lower = linearRGB * vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    ",toLinear:"\n      vec4 function(vec4 sRGB) {\n        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));\n        vec4 lower = sRGB/vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    ",calcPoint:"\n      vec2 function(float d, float angle) {\n        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);\n      }\n    "}),a(xe,"ColorLoop",e=>{let t="";for(let s=2;s<e;s++)t+="colorOut = mix(colorOut, colors[".concat(s,"], clamp((dist - stops[").concat(s-1,"]) / (stops[").concat(s,"] - stops[").concat(s-1,"]), 0.0, 1.0));");return t}),a(xe,"onColorize",e=>{const t=e.colors.length||1;return"\n      float a = angle - (PI / 180.0 * 90.0);\n      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));\n      vec2 f = $calcPoint(lineDist * 0.5, a);\n      vec2 t = $calcPoint(lineDist * 0.5, a + PI);\n      vec2 gradVec = t - f;\n      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));\n      ".concat(xe.ColorLoop(t),"\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    ")});let Bt=xe;class Ft extends V{constructor(){super(...arguments);a(this,"name","grayscale")}static getEffectKey(){return"grayscale"}static resolveDefaults(e){var t;return{amount:(t=e.amount)!=null?t:1}}}a(Ft,"uniforms",{amount:{value:1,method:"uniform1f",type:"float"}}),a(Ft,"onColorize","\n    float grayness = 0.2 * maskColor.r + 0.6 * maskColor.g + 0.2 * maskColor.b;\n    return vec4(amount * vec3(grayness) + (1.0 - amount) * maskColor.rgb, maskColor.a);\n  ");class Me extends V{constructor(){super(...arguments);a(this,"name","borderRight")}static getEffectKey(){return"borderRight"}static resolveDefaults(e){var t,s;return{width:(t=e.width)!=null?t:10,color:(s=e.color)!=null?s:4294967295}}}a(Me,"z$__type__Props"),a(Me,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:e=>ae(e),method:"uniform4fv",type:"vec4"}}),a(Me,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",rectDist:"\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "}),a(Me,"onEffectMask","\n  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  "),a(Me,"onColorize","\n    return color;\n  ");class Le extends V{constructor(){super(...arguments);a(this,"name","borderTop")}static getEffectKey(){return"borderTop"}static resolveDefaults(e){var t,s;return{width:(t=e.width)!=null?t:10,color:(s=e.color)!=null?s:4294967295}}}a(Le,"z$__type__Props"),a(Le,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:e=>ae(e),method:"uniform4fv",type:"vec4"}}),a(Le,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",rectDist:"\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "}),a(Le,"onEffectMask","\n  vec2 pos = vec2(0.0, width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  "),a(Le,"onColorize","\n    return color;\n  ");class ke extends V{constructor(){super(...arguments);a(this,"name","borderBottom")}static getEffectKey(){return"borderBottom"}static resolveDefaults(e){var t,s;return{width:(t=e.width)!=null?t:10,color:(s=e.color)!=null?s:4294967295}}}a(ke,"z$__type__Props"),a(ke,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:e=>ae(e),method:"uniform4fv",type:"vec4"}}),a(ke,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",rectDist:"\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "}),a(ke,"onEffectMask","\n  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  "),a(ke,"onColorize","\n    return color;\n  ");class Ne extends V{constructor(){super(...arguments);a(this,"name","borderLeft")}static getEffectKey(){return"borderLeft"}static resolveDefaults(e){var t,s;return{width:(t=e.width)!=null?t:10,color:(s=e.color)!=null?s:4294967295}}}a(Ne,"z$__type__Props"),a(Ne,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,validator:e=>ae(e),method:"uniform4fv",type:"vec4"}}),a(Ne,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",rectDist:"\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "}),a(Ne,"onEffectMask","\n  vec2 pos = vec2(width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  "),a(Ne,"onColorize","\n    return color;\n  ");class He extends V{constructor(){super(...arguments);a(this,"name","glitch")}static getEffectKey(e){return"glitch"}static resolveDefaults(e){var t,s,o,n,l;return{amplitude:(t=e.amplitude)!=null?t:.2,narrowness:(s=e.narrowness)!=null?s:4,blockiness:(o=e.blockiness)!=null?o:2,minimizer:(n=e.minimizer)!=null?n:8,time:(l=e.time)!=null?l:Date.now()}}}a(He,"z$__type__Props"),a(He,"uniforms",{amplitude:{value:0,method:"uniform1f",type:"float"},narrowness:{value:0,method:"uniform1f",type:"float"},blockiness:{value:0,method:"uniform1f",type:"float"},minimizer:{value:0,method:"uniform1f",type:"float"},time:{value:0,method:"uniform1f",validator:e=>(Date.now()-e)%1e3,type:"float"}}),a(He,"methods",{rand:"\n      float function(vec2 p, float time) {\n        float t = floor(time * 20.) / 10.;\n        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);\n      }\n    ",noise:"\n      float function(vec2 uv, float blockiness, float time) {\n        vec2 lv = fract(uv);\n        vec2 id = floor(uv);\n\n        float n1 = rand(id, time);\n        float n2 = rand(id+vec2(1,0), time);\n        float n3 = rand(id+vec2(0,1), time);\n        float n4 = rand(id+vec2(1,1), time);\n        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n      }\n    ",fbm:"\n      float function(vec2 uv, int count, float blockiness, float complexity, float time) {\n        float val = 0.0;\n        float amp = 0.5;\n        const int MAX_ITERATIONS = 10;\n\n        for(int i = 0; i < MAX_ITERATIONS; i++) {\n          if(i >= count) {break;}\n          val += amp * noise(uv, blockiness, time);\n          amp *= 0.5;\n          uv *= complexity;\n        }\n        return val;\n      }\n    "}),a(He,"onColorize","\n    vec2 uv = v_textureCoordinate.xy;\n    float aspect = u_dimensions.x / u_dimensions.y;\n    vec2 a = vec2(uv.x * aspect , uv.y);\n    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));\n\n    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);\n    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);\n    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);\n    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n\n    vec3 f = vec3(colR, colG, colB);\n    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);\n  ");class ft extends V{constructor(){super(...arguments);a(this,"name","fadeOut")}static getEffectKey(){return"fadeOut"}static resolveDefaults(e){var t;return{fade:(t=e.fade)!=null?t:10}}}a(ft,"z$__type__Props"),a(ft,"uniforms",{fade:{value:0,method:"uniform4fv",type:"vec4",validator:e=>{let t=e;return Array.isArray(t)?t.length===2?t=[t[0],t[1],t[0],t[1]]:t.length===3?t=[t[0],t[1],t[2],t[0]]:t.length!==4&&(t=[t[0],t[0],t[0],t[0]]):typeof t=="number"&&(t=[t,t,t,t]),t}}}),a(ft,"onColorize","\n  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;\n  vec2 pos1;\n  vec2 pos2;\n  vec2 d;\n  float c;\n  vec4 result = maskColor;\n\n\n  if(fade[0] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x, point.y + fade[0]);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[1] > 0.0) {\n    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);\n    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[2] > 0.0) {\n    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);\n    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[3] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x + fade[3], point.y);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  return result;\n  ");const Se=class Se extends V{constructor(){super(...arguments);a(this,"name","radialGradient")}static getEffectKey(e){return"radialGradient".concat(e.colors.length)}static resolveDefaults(e){var o,n,l,h,d;const t=(o=e.colors)!=null?o:[4278190080,4294967295];let s=e.stops||[];if(s.length===0||s.length!==t.length){const f=t.length;let u=0;const y=s;for(;u<f;u++)s[u]?(y[u]=s[u],s[u-1]===void 0&&y[u-2]!==void 0&&(y[u-1]=y[u-2]+(s[u]-y[u-2])/2)):y[u]=u*(1/(t.length-1));s=y}return{colors:t,stops:s,width:(n=e.width)!=null?n:0,height:(h=(l=e.height)!=null?l:e.width)!=null?h:0,pivot:(d=e.pivot)!=null?d:[.5,.5]}}};a(Se,"z$__type__Props"),a(Se,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},pivot:{value:[.5,.5],method:"uniform2fv",type:"vec2"},colors:{value:4294967295,validator:e=>e.map(s=>ae(s)).reduce((s,o)=>s.concat(o),[]),size:e=>e.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:e=>e.colors.length,method:"uniform1fv",type:"float"}}),a(Se,"ColorLoop",e=>{let t="";for(let s=2;s<e;s++)t+="colorOut = mix(colorOut, colors[".concat(s,"], clamp((dist - stops[").concat(s-1,"]) / (stops[").concat(s,"] - stops[").concat(s-1,"]), 0.0, 1.0));");return t}),a(Se,"onColorize",e=>{const t=e.colors.length||1;return"\n      vec2 point = v_textureCoordinate.xy * u_dimensions;\n      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);\n\n      float dist = length((point - projection) / vec2(width, height));\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = mix(colors[0], colors[1], stopCalc);\n      ".concat(Se.ColorLoop(t),"\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    ")});let Pt=Se;class Ae extends V{constructor(){super(...arguments);a(this,"name","radialProgress")}static getEffectKey(){return"radialProgress"}static resolveDefaults(e){var t,s,o,n,l,h,d;return{width:(t=e.width)!=null?t:10,progress:(s=e.progress)!=null?s:.5,offset:(o=e.offset)!=null?o:0,range:(n=e.range)!=null?n:Math.PI*2,rounded:(l=e.rounded)!=null?l:!1,radius:(h=e.radius)!=null?h:1,color:(d=e.color)!=null?d:4294967295}}}a(Ae,"z$__type__Props"),a(Ae,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},progress:{value:.5,method:"uniform1f",type:"float"},offset:{value:0,method:"uniform1f",type:"float"},range:{value:0,method:"uniform1f",type:"float"},rounded:{value:0,method:"uniform1f",type:"float",validator:e=>e?1:0},radius:{value:1,method:"uniform1f",type:"float"},color:{value:4294967295,validator:e=>ae(e),method:"uniform4fv",type:"vec4"}}),a(Ae,"methods",{rotateUV:"\n    vec2 function(vec2 uv, float d) {\n      float s = sin(d);\n      float c = cos(d);\n      mat2 rotMatrix = mat2(c, -s, s, c);\n      return uv * rotMatrix;\n    }\n    ",drawDot:"\n    float function(vec2 uv, vec2 p, float r) {\n      uv += p;\n      float circle = length(uv) - r;\n      return clamp(-circle, 0.0, 1.0);\n    }\n    "}),a(Ae,"onEffectMask","\n    float outerRadius = radius * u_dimensions.y * 0.5;\n\n    float endAngle = range * progress - 0.0005;\n\n    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;\n\n    uv = $rotateUV(uv, -(offset));\n    float linewidth = width * u_pixelRatio;\n    float circle = length(uv) - (outerRadius - linewidth) ;\n    circle = abs(circle) - linewidth;\n    circle = clamp(-circle, 0.0, 1.0);\n\n    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);\n    float p = endAngle / (PI * 2.);\n\n    circle *= step(fract(angle), fract(p));\n\n    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));\n    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));\n\n    return mix(shaderColor, maskColor, circle);\n  "),a(Ae,"onColorize","\n    return color;\n  ");class ze extends V{constructor(){super(...arguments);a(this,"name","holePunch")}static getEffectKey(){return"holePunch"}static resolveDefaults(e){var t;return{x:e.x||0,y:e.y||0,width:e.width||50,height:e.height||50,radius:(t=e.radius)!=null?t:0}}}a(ze,"z$__type__Props"),a(ze,"uniforms",{x:{value:0,method:"uniform1f",type:"float"},y:{value:0,method:"uniform1f",type:"float"},width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},radius:{value:0,method:"uniform4fv",type:"vec4",validator:e=>{let t=e;return Array.isArray(t)?t.length===2?t=[t[0],t[1],t[0],t[1]]:t.length===3?t=[t[0],t[1],t[2],t[0]]:t.length!==4&&(t=[t[0],t[0],t[0],t[0]]):typeof t=="number"&&(t=[t,t,t,t]),t}}}),a(ze,"methods",{fillMask:"\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",boxDist:"\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    "}),a(ze,"onShaderMask","\n  vec2 halfDimensions = u_dimensions * 0.5;\n  vec2 size = vec2(width, height) * 0.5;\n  vec2 basePos = v_textureCoordinate.xy * u_dimensions.xy - vec2(x, y);\n  vec2 pos = basePos - size;\n  float r = radius[0] * step(pos.x, 0.5) * step(pos.y, 0.5);\n  r = r + radius[1] * step(0.5, pos.x) * step(pos.y, 0.5);\n  r = r + radius[2] * step(0.5, pos.x) * step(0.5, pos.y);\n  r = r + radius[3] * step(pos.x, 0.5) * step(0.5, pos.y);\n  return $boxDist(pos, size, r);\n  "),a(ze,"onEffectMask","\n  return mix(maskColor, vec4(0.0), $fillMask(shaderMask));\n  ");const mi="RoundedRectangle";class xi extends $i{constructor(e){super();a(this,"shType");this.shType=e,e!==mi&&console.warn("Unsupported shader:",e)}bindRenderOp(){}bindProps(){}attach(){}detach(){}}class os{constructor(){a(this,"shCache",new Map);a(this,"shConstructors",{});a(this,"attachedShader",null);a(this,"effectConstructors",{});a(this,"renderer");this.registerShaderType("DefaultShader",fi),this.registerShaderType("DefaultShaderBatched",pi),this.registerShaderType("RoundedRectangle",At),this.registerShaderType("DynamicShader",Fe),this.registerShaderType("SdfShader",zt),this.registerEffectType("border",Ue),this.registerEffectType("borderBottom",ke),this.registerEffectType("borderLeft",Ne),this.registerEffectType("borderRight",Me),this.registerEffectType("borderTop",Le),this.registerEffectType("fadeOut",ft),this.registerEffectType("linearGradient",Bt),this.registerEffectType("radialGradient",Pt),this.registerEffectType("grayscale",Ft),this.registerEffectType("glitch",He),this.registerEffectType("radius",Ie),this.registerEffectType("radialProgress",Ae),this.registerEffectType("holePunch",ze)}registerShaderType(i,e){this.shConstructors[i]=e}registerEffectType(i,e){this.effectConstructors[i]=e}getRegisteredEffects(){return this.effectConstructors}getRegisteredShaders(){return this.shConstructors}loadShader(i,e){if(!this.renderer)throw new Error("Renderer is not been defined");const t=this.shConstructors[i];if(!t)throw new Error('Shader type "'.concat(i,'" is not registered'));if(this.renderer.mode==="canvas"&&t.prototype instanceof Ee)return{shader:new xi(i),props:e};if(i==="DynamicShader")return this.loadDynamicShader(e);const s=t.resolveDefaults(e),o=t.makeCacheKey(s)||t.name;if(o&&this.shCache.has(o))return{shader:this.shCache.get(o),props:s};const n=new t(this.renderer,e);return o&&this.shCache.set(o,n),{shader:n,props:s}}loadDynamicShader(i){if(!this.renderer)throw new Error("Renderer is not been defined");const e=Fe.resolveDefaults(i,this.effectConstructors),t=Fe.makeCacheKey(e,this.effectConstructors);if(t&&this.shCache.has(t))return{shader:this.shCache.get(t),props:e};const s=new Fe(this.renderer,i,this.effectConstructors);return t&&this.shCache.set(t,s),{shader:s,props:e}}useShader(i){this.attachedShader!==i&&(this.attachedShader&&this.attachedShader.detach(),i.attach(),this.attachedShader=i)}}function ns(r){return/\.(ktx|pvr)$/.test(r)}const as=async r=>{const e=await(await fetch(r)).arrayBuffer();return r.indexOf(".ktx")!==-1?ls(e):hs(e)},ls=async r=>{const i=new DataView(r),e=i.getUint32(12)===16909060,t=[],s={glInternalFormat:i.getUint32(28,e),pixelWidth:i.getUint32(36,e),pixelHeight:i.getUint32(40,e),numberOfMipmapLevels:i.getUint32(56,e),bytesOfKeyValueData:i.getUint32(60,e)};let o=64;o+=s.bytesOfKeyValueData;for(let n=0;n<s.numberOfMipmapLevels;n++){const l=i.getUint32(o);o+=4,t.push(i.buffer.slice(o,l)),o+=l}return{data:{glInternalFormat:s.glInternalFormat,mipmaps:t,width:s.pixelWidth||0,height:s.pixelHeight||0,type:"ktx"},premultiplyAlpha:!1}},hs=async r=>{const l=r,h=new Int32Array(l,0,13),d=h[12]+52,f=new Uint8Array(l,d),u=[],y={pixelWidth:h[7],pixelHeight:h[6],numberOfMipmapLevels:h[11]||0};let x=0,w=y.pixelWidth||0,_=y.pixelHeight||0;for(let m=0;m<y.numberOfMipmapLevels;m++){const R=(w+3>>2)*(_+3>>2)*8,g=new Uint8Array(l,f.byteOffset+x,R);u.push(g),x+=R,w=w>>1,_=_>>1}return{data:{glInternalFormat:36196,mipmaps:u,width:y.pixelWidth||0,height:y.pixelHeight||0,type:"pvr"},premultiplyAlpha:!1}},Ge=class Ge extends ai{constructor(e,t){super(e);a(this,"props");this.props=Ge.resolveDefaults(t)}hasAlphaChannel(e){return e.indexOf("image/png")!==-1}async getTextureData(){const{src:e,premultiplyAlpha:t}=this.props;if(!e)return{data:null};if(e instanceof ImageData)return{data:e,premultiplyAlpha:t};if(ns(e))return as(e);if(this.txManager.imageWorkerManager)return await this.txManager.imageWorkerManager.getImage(e,t);if(this.txManager.hasCreateImageBitmap){const o=await(await fetch(e)).blob(),n=t!=null?t:this.hasAlphaChannel(o.type);return{data:await createImageBitmap(o,{premultiplyAlpha:n?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:n}}else{const s=new Image;return e.substr(0,5)!=="data:"&&(s.crossOrigin="Anonymous"),s.src=e,await new Promise((o,n)=>{s.onload=()=>o(),s.onerror=()=>n(new Error("Failed to load image"))}).catch(o=>{console.error(o)}),{data:s,premultiplyAlpha:t!=null?t:!0}}}static makeCacheKey(e){const t=Ge.resolveDefaults(e);return t.src instanceof ImageData?!1:"ImageTexture,".concat(t.src,",").concat(t.premultiplyAlpha)}static resolveDefaults(e){var t,s;return{src:(t=e.src)!=null?t:"",premultiplyAlpha:(s=e.premultiplyAlpha)!=null?s:!0}}};a(Ge,"z$__type__Props");let Et=Ge;const cs=24;function ds(r,i,e,t,s,o,n,l,h){const d=Math.min(Math.max(n.firstLineIdx,0),l.length),f=0;let u=0;t==="middle"?u=(i-r)/2:t==="bottom"&&(u=i-r);const x=s/o+d*i+u;if(!(h&&x>=h/o))return{sdfX:f,sdfY:x,lineIndex:d}}class Xe{constructor(i,e=0){a(this,"iterator");a(this,"peekBuffer",[]);a(this,"_lastIndex");this.iterator=i,this.iterator=i,this._lastIndex=e-1,this.peekBuffer=[]}next(){const i=this.peekBuffer.length>0?this.peekBuffer.pop():this.iterator.next();return i.done?this._lastIndex=-1:this._lastIndex++,i}peek(){if(this.peekBuffer.length>0)return this.peekBuffer[0];const i=this.iterator.next();return this.peekBuffer.push(i),i}get lastIndex(){return this._lastIndex}}function*Ve(r,i=0){let e=i;for(;e<r.length;){const t=r.codePointAt(e);if(t===void 0)throw new Error("Invalid Unicode code point");yield t,e+=t<=65535?1:2}}function us(r,i,e){const t=e.shapeText(i,new Xe(Ve(r,0),0));let s=0;for(const o of t)o.mapped&&(s+=o.xAdvance);return s}function fs(r,i,e,t,s,o,n,l,h,d,f,u,y,x,w,_,m,R,g){M(w,"Font face must be loaded"),M(w.loaded,"Font face must be loaded"),M(w.data,"Font face must be loaded"),M(w.shaper,"Font face must be loaded");const p=l/w.data.info.size,c=h/p,v=o/p,I=d/p,b=y[r],S=(b==null?void 0:b.codepointIndex)||0,T=(b==null?void 0:b.maxX)||0,k=(b==null?void 0:b.maxY)||0;let L=T,A=k,F=i,z=e,N=0;const B={codepointIndex:-1,bufferOffset:-1,xStart:-1},D=w.shaper,se={letterSpacing:I};let oe=D.shapeText(se,new Xe(Ve(t,S),S)),Q,ce=-1;const de=[],Je=n/p,et=us(R,se,D);let ve=!0;for(;ve;){const re=(g===0||r+1<g)&&(u!=="both"||m||z+c+w.maxCharHeight<=Je),Z=re?v:v-et;let X=0;const ue=z+c>=x.y1,fe=z<=x.y2,J=ue&&fe;for(;(Q=oe.next())&&!Q.done;){const E=Q.value;if(r===y.length)y.push({codepointIndex:E.cluster,maxY:A,maxX:L});else if(r>y.length)throw new Error("Unexpected lineCache length");if(E.codepoint===32||E.codepoint===10?B.codepointIndex!==-1&&(B.codepointIndex=-1,X=F):B.codepointIndex===-1&&(B.codepointIndex=E.cluster,B.bufferOffset=N,B.xStart=X),E.mapped){const tt=F+E.xOffset+E.width;if(u!=="none"&&tt>=Z&&B.codepointIndex!==-1&&B.xStart>0)if(re){oe=D.shapeText(se,new Xe(Ve(t,B.codepointIndex),B.codepointIndex)),N=B.bufferOffset;break}else oe=D.shapeText(se,new Xe(Ve(R,0),0)),F=B.xStart,N=B.bufferOffset,u="none";else{const pe=F+E.xOffset,ge=z+E.yOffset;if(J){ce===-1&&(ce=N);const we=w.getAtlasEntry(E.glyphId),Te=we.x/w.data.common.scaleW,_e=we.y/w.data.common.scaleH,Oe=we.width/w.data.common.scaleW,$e=we.height/w.data.common.scaleH;f[N++]=pe,f[N++]=ge,f[N++]=Te,f[N++]=_e,f[N++]=pe+E.width,f[N++]=ge,f[N++]=Te+Oe,f[N++]=_e,f[N++]=pe,f[N++]=ge+E.height,f[N++]=Te,f[N++]=_e+$e,f[N++]=pe+E.width,f[N++]=ge+E.height,f[N++]=Te+Oe,f[N++]=_e+$e}A=Math.max(A,ge+E.height),L=Math.max(L,pe+E.width),F+=E.xAdvance}}else if(E.codepoint===10){if(re)break;oe=D.shapeText(se,new Xe(Ve(R,0),0)),u="none"}}ce!==-1&&(de.push({bufferStart:ce,bufferEnd:N}),ce=-1),F=0,z+=c,r++,B.codepointIndex=-1,X=0,!_&&u==="both"&&z>x.y2||Q&&Q.done?ve=!1:re||(ve=!1)}if(s==="center"){const re=u==="none"?L:v;for(let Z=0;Z<de.length;Z++){const X=de[Z],ue=f[X.bufferEnd-4]-f[X.bufferStart],fe=(re-ue)/2;for(let J=X.bufferStart;J<X.bufferEnd;J+=4)f[J]+=fe}}else if(s==="right"){const re=u==="none"?L:v;for(let Z=0;Z<de.length;Z++){const X=de[Z],ue=X.bufferEnd===X.bufferStart?0:f[X.bufferEnd-4]-f[X.bufferStart],fe=re-ue;for(let J=X.bufferStart;J<X.bufferEnd;J+=4)f[J]+=fe}}return M(Q),{bufferNumFloats:N,bufferNumQuads:N/16,layoutNumCharacters:Q.done?t.length-S:Q.value.cluster-S+1,fullyProcessed:!!Q.done,maxX:L,maxY:A}}function ps(r,i){return Math.ceil(r/i)*i}function gs(r,i){return Math.floor(r/i)*i}function ms(r,i,e,t,s,o,n,l){const{screen:h,sdf:d}=r;if(!Di(n))h.x1=0,h.y1=0,h.x2=0,h.y2=0,d.x1=0,d.y1=0,d.x2=0,d.y2=0,r.numLines=0,r.firstLineIdx=0;else{const f=n.x1-i,u=f+(n.x2-n.x1),y=n.y1-e+t,x=gs(y-o,s||1),w=ps(y+(n.y2-n.y1)+o,s||1);h.x1=f,h.y1=x,h.x2=u,h.y2=w,d.x1=f/l,d.y1=x/l,d.x2=u/l,d.y2=w/l,r.numLines=Math.ceil((w-x)/s),r.firstLineIdx=s?Math.floor(x/s):0}r.valid=!0}const xs={normal:400,bold:700,bolder:900,lighter:100},ti=r=>typeof r=="number"?r:xs[r]||400;function ys(r,i,e,t,s){let o=ti(e);for(const n of r){const l=n[i];if(!l)continue;if(l.size===1)return console.warn("TrFontManager: Only one font face found for family: '".concat(i,"' - will be used for all weights and styles")),l.values().next().value;const h=new Map;for(const f of l){const u=ti(f.descriptors.weight);if(u===o&&f.descriptors.style===t&&f.descriptors.stretch===s)return f;h.set(u,f)}const d="TrFontManager: No exact match: '".concat(i," Weight: ").concat(o," Style: ").concat(t," Stretch: ").concat(s,"'");if(console.error(d),o===400&&h.has(500))return h.get(500);if(o===500&&h.has(400))return h.get(400);if(o<400){for(;o>0;){if(h.has(o))return h.get(o);o-=100}o=600}for(;o<1e3;){if(h.has(o))return h.get(o);o+=100}for(o=500;o>0;){if(h.has(o))return h.get(o);o-=100}}}const vs=gi(ys);class yi{constructor(i){a(this,"textRenderers");this.textRenderers=i}addFontFace(i){for(const e in this.textRenderers){const t=this.textRenderers[e];t&&t.isFontFaceSupported(i)&&t.addFontFace(i)}}static resolveFontFace(i,e){const{fontFamily:t,fontWeight:s,fontStyle:o,fontStretch:n}=e;return vs(i,t,s,o,n)}}const ws={x:0,y:0,width:0,height:0};class Ts extends ui{constructor(e){super(e);a(this,"ssdfFontFamilies",{});a(this,"msdfFontFamilies",{});a(this,"fontFamilyArray",[this.ssdfFontFamilies,this.msdfFontFamilies]);a(this,"sdfShader");a(this,"rendererBounds");this.sdfShader=this.stage.shManager.loadShader("SdfShader").shader,this.rendererBounds={x1:0,y1:0,x2:this.stage.options.appWidth,y2:this.stage.options.appHeight}}getPropertySetters(){return{fontFamily:(e,t)=>{e.props.fontFamily=t,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontWeight:(e,t)=>{e.props.fontWeight=t,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontStyle:(e,t)=>{e.props.fontStyle=t,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontStretch:(e,t)=>{e.props.fontStretch=t,this.releaseFontFace(e),this.invalidateLayoutCache(e)},fontSize:(e,t)=>{e.props.fontSize=t,this.invalidateLayoutCache(e)},text:(e,t)=>{e.props.text=t,this.invalidateLayoutCache(e)},textAlign:(e,t)=>{e.props.textAlign=t,this.invalidateLayoutCache(e)},color:(e,t)=>{e.props.color=t},x:(e,t)=>{e.props.x=t,e.elementBounds.valid&&(this.setElementBoundsX(e),!e.renderWindow.valid&&Rt(e.elementBounds,this.rendererBounds)&&this.scheduleUpdateState(e))},y:(e,t)=>{e.props.y=t,e.elementBounds.valid&&(this.setElementBoundsY(e),!e.renderWindow.valid&&Rt(e.elementBounds,this.rendererBounds)&&this.scheduleUpdateState(e))},contain:(e,t)=>{e.props.contain=t,this.invalidateLayoutCache(e)},width:(e,t)=>{e.props.width=t,e.props.contain!=="none"&&this.invalidateLayoutCache(e)},height:(e,t)=>{e.props.height=t,e.props.contain==="both"&&this.invalidateLayoutCache(e)},offsetY:(e,t)=>{e.props.offsetY=t,this.invalidateLayoutCache(e)},scrollable:(e,t)=>{e.props.scrollable=t,this.invalidateLayoutCache(e)},scrollY:(e,t)=>{e.props.scrollY=t,this.scheduleUpdateState(e)},letterSpacing:(e,t)=>{e.props.letterSpacing=t,this.invalidateLayoutCache(e)},lineHeight:(e,t)=>{e.props.lineHeight=t,this.invalidateLayoutCache(e)},maxLines:(e,t)=>{e.props.maxLines=t,this.invalidateLayoutCache(e)},textBaseline:(e,t)=>{e.props.textBaseline=t,this.invalidateLayoutCache(e)},verticalAlign:(e,t)=>{e.props.verticalAlign=t,this.invalidateLayoutCache(e)},overflowSuffix:(e,t)=>{e.props.overflowSuffix=t,this.invalidateLayoutCache(e)},debug:(e,t)=>{e.props.debug=t}}}canRenderFont(e){const{fontFamily:t}=e;return t in this.ssdfFontFamilies||t in this.msdfFontFamilies||t==="$$SDF_FAILURE_TEST$$"}isFontFaceSupported(e){return e instanceof Vt}addFontFace(e){M(e instanceof Vt);const t=e.fontFamily,s=e.type==="ssdf"?this.ssdfFontFamilies:e.type==="msdf"?this.msdfFontFamilies:void 0;if(!s){console.warn("Invalid font face type: ".concat(e.type));return}let o=s[t];o||(o=new Set,s[t]=o),o.add(e)}createState(e){return{props:e,status:"initialState",updateScheduled:!1,emitter:new Re,lineCache:[],forceFullLayoutCalc:!1,renderWindow:{screen:{x1:0,y1:0,x2:0,y2:0},sdf:{x1:0,y1:0,x2:0,y2:0},firstLineIdx:0,numLines:0,valid:!1},elementBounds:{x1:0,y1:0,x2:0,y2:0,valid:!1},clippingRect:{x:0,y:0,width:0,height:0,valid:!1},bufferNumFloats:0,bufferNumQuads:0,vertexBuffer:void 0,webGlBuffers:null,bufferUploaded:!1,textH:void 0,textW:void 0,distanceRange:0,trFontFace:void 0,isRenderable:!1,debugData:{updateCount:0,layoutCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,drawCount:0,bufferSize:0}}}updateState(e){let{trFontFace:t}=e;const{textH:s,lineCache:o,debugData:n,forceFullLayoutCalc:l}=e;if(n.updateCount++,e.status==="initialState"&&this.setStatus(e,"loading"),!t){if(t=this.resolveFontFace(e.props),e.trFontFace=t,!t){const D="SdfTextRenderer: Could not resolve font face for family: '".concat(e.props.fontFamily,"'");console.error(D),this.setStatus(e,"failed",new Error(D));return}t.texture.setRenderableOwner(e,e.isRenderable)}if(!t.loaded){t.once("loaded",()=>{this.scheduleUpdateState(e)});return}M(t.data,"Font face data should be loaded");const{text:h,fontSize:d,x:f,y:u,contain:y,width:x,height:w,lineHeight:_,verticalAlign:m,scrollable:R,overflowSuffix:g,maxLines:p}=e.props,c=y==="both"&&R?e.props.scrollY:0,{renderWindow:v}=e,I=t.data.info.size,b=d/I,S=_/b;e.distanceRange=b*t.data.distanceField.distanceRange;const T=h.length*cs;let k=e.vertexBuffer;(!k||k.length<T)&&(k=new Float32Array(T*2));const L=e.elementBounds;if(L.valid||(this.setElementBoundsX(e),this.setElementBoundsY(e),L.valid=!0),!l&&v.valid){const D=v.screen;if(f+D.x1<=L.x1&&f+D.x2>=L.x2&&u-c+D.y1<=L.y1&&u-c+D.y2>=L.y2){this.setStatus(e,"loaded");return}v.valid=!1,this.setStatus(e,"loading")}const{offsetY:A,textAlign:F}=e.props;if(!v.valid){if(!Rt(L,this.rendererBounds))return;ms(v,f,u,c,_,y==="both"?L.y2-L.y1:0,L,b)}const z=ds(I,S,_,m,A,b,v,o,s);if(!z){this.setStatus(e,"loaded");return}const{letterSpacing:N}=e.props,B=fs(z.lineIndex,z.sdfX,z.sdfY,h,F,x,w,d,_,N,k,y,o,v.sdf,t,l,R,g,p);e.bufferUploaded=!1,e.bufferNumFloats=B.bufferNumFloats,e.bufferNumQuads=B.bufferNumQuads,e.vertexBuffer=k,e.renderWindow=v,n.lastLayoutNumCharacters=B.layoutNumCharacters,n.bufferSize=k.byteLength,B.fullyProcessed&&(e.textW=B.maxX*b,e.textH=B.maxY*b),this.setStatus(e,"loaded")}renderQuads(e,t,s,o,n,l){var L,A,F;if(!e.vertexBuffer)return;const h=this.stage.renderer;M(h instanceof li);const{fontSize:d,color:f,contain:u,scrollable:y,zIndex:x,debug:w}=e.props,_=u==="both"&&y?e.props.scrollY:0,{textW:m=0,textH:R=0,distanceRange:g,vertexBuffer:p,bufferUploaded:c,trFontFace:v,elementBounds:I}=e;let{webGlBuffers:b}=e;if(!b){const z=h.glw,N=4*Float32Array.BYTES_PER_ELEMENT,B=z.createBuffer();M(B),e.webGlBuffers=new Yi([{buffer:B,attributes:{a_position:{name:"a_position",size:2,type:z.FLOAT,normalized:!1,stride:N,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:z.FLOAT,normalized:!1,stride:N,offset:2*Float32Array.BYTES_PER_ELEMENT}}}]),e.bufferUploaded=!1,M(e.webGlBuffers),b=e.webGlBuffers}if(!c){const z=h.glw,N=(L=b==null?void 0:b.getBuffer("a_textureCoordinate"))!=null?L:null;z.arrayBufferData(N,p,z.STATIC_DRAW),e.bufferUploaded=!0}if(M(v),y&&u==="both"){M(I.valid);const z=Wi(I,ws);s.valid?(e.clippingRect.valid=!0,s=Yt(s,z,e.clippingRect)):(e.clippingRect.valid=!0,s=hi(z,e.clippingRect))}const S=new Ui(h.glw,h.options,b,this.sdfShader,{transform:t.data,color:Hi(f,o),size:d/(((A=v.data)==null?void 0:A.info.size)||0),scrollY:_,distanceRange:g,debug:w.sdfShaderDebug},o,s,{height:R,width:m},0,x,!1,n,l),T=(F=e.trFontFace)==null?void 0:F.texture;M(T);const k=this.stage.txManager.getCtxTexture(T);S.addTexture(k),S.length=e.bufferNumFloats,S.numQuads=e.bufferNumQuads,h.addRenderOp(S)}setIsRenderable(e,t){var s;super.setIsRenderable(e,t),(s=e.trFontFace)==null||s.texture.setRenderableOwner(e,t)}destroyState(e){var t;super.destroyState(e),(t=e.trFontFace)==null||t.texture.setRenderableOwner(e,!1)}resolveFontFace(e){return yi.resolveFontFace(this.fontFamilyArray,e)}releaseFontFace(e){e.trFontFace&&(e.trFontFace.texture.setRenderableOwner(e,!1),e.trFontFace=void 0)}invalidateLayoutCache(e){e.renderWindow.valid=!1,e.elementBounds.valid=!1,e.textH=void 0,e.textW=void 0,e.lineCache=[],this.setStatus(e,"loading"),this.scheduleUpdateState(e)}setElementBoundsX(e){const{x:t,contain:s,width:o}=e.props,{elementBounds:n}=e;n.x1=t,n.x2=s!=="none"?t+o:1/0}setElementBoundsY(e){const{y:t,contain:s,height:o}=e.props,{elementBounds:n}=e;n.y1=t,n.y2=s==="both"?t+o:1/0}}const _s=(r,i)=>r===i,Ot=Symbol("solid-proxy"),gt={equals:_s};let vi=bi;const ye=1,mt=2,wi={owned:null,cleanups:null,context:null,owner:null};var P=null;let Mt=null,Ss=null,H=null,G=null,he=null,St=0;function bs(r,i){const e=H,t=P,s=r.length===0,o=i===void 0?t:i,n=s?wi:{owned:null,cleanups:null,context:o?o.context:null,owner:o},l=s?r:()=>r(()=>qe(()=>bt(n)));P=n,H=null;try{return Ze(l,!0)}finally{H=e,P=t}}function Cs(r,i){i=i?Object.assign({},gt,i):gt;const e={value:r,observers:null,observerSlots:null,comparator:i.equals||void 0},t=s=>(typeof s=="function"&&(s=s(e.value)),Si(e,s));return[_i.bind(e),t]}function me(r,i,e){const t=Wt(r,i,!1,ye);Qe(t)}function Cr(r,i,e){vi=Ls;const t=Wt(r,i,!1,ye),s=ii&&Rs(ii);s&&(t.suspense=s),t.user=!0,he?he.push(t):Qe(t)}function Ti(r,i,e){e=e?Object.assign({},gt,e):gt;const t=Wt(r,i,!0,0);return t.observers=null,t.observerSlots=null,t.comparator=e.equals||void 0,Qe(t),_i.bind(t)}function qe(r){if(H===null)return r();const i=H;H=null;try{return r()}finally{H=i}}function Rr(r,i,e){const t=Array.isArray(r);let s,o=e&&e.defer;return n=>{let l;if(t){l=Array(r.length);for(let d=0;d<r.length;d++)l[d]=r[d]()}else l=r();if(o)return o=!1,n;const h=qe(()=>i(l,s,n));return s=l,h}}function Ir(r){return P===null||(P.cleanups===null?P.cleanups=[r]:P.cleanups.push(r)),r}function Mr(){return P}function Rs(r){let i;return P&&P.context&&(i=P.context[r.id])!==void 0?i:r.defaultValue}let ii;function _i(){if(this.sources&&this.state)if(this.state===ye)Qe(this);else{const r=G;G=null,Ze(()=>yt(this),!1),G=r}if(H){const r=this.observers?this.observers.length:0;H.sources?(H.sources.push(this),H.sourceSlots.push(r)):(H.sources=[this],H.sourceSlots=[r]),this.observers?(this.observers.push(H),this.observerSlots.push(H.sources.length-1)):(this.observers=[H],this.observerSlots=[H.sources.length-1])}return this.value}function Si(r,i,e){let t=r.value;return(!r.comparator||!r.comparator(t,i))&&(r.value=i,r.observers&&r.observers.length&&Ze(()=>{for(let s=0;s<r.observers.length;s+=1){const o=r.observers[s],n=Mt&&Mt.running;n&&Mt.disposed.has(o),(n?!o.tState:!o.state)&&(o.pure?G.push(o):he.push(o),o.observers&&Ci(o)),n||(o.state=ye)}if(G.length>1e6)throw G=[],new Error},!1)),i}function Qe(r){if(!r.fn)return;bt(r);const i=St;Is(r,r.value,i)}function Is(r,i,e){let t;const s=P,o=H;H=P=r;try{t=r.fn(i)}catch(n){return r.pure&&(r.state=ye,r.owned&&r.owned.forEach(bt),r.owned=null),r.updatedAt=e+1,Ri(n)}finally{H=o,P=s}(!r.updatedAt||r.updatedAt<=e)&&(r.updatedAt!=null&&"observers"in r?Si(r,t):r.value=t,r.updatedAt=e)}function Wt(r,i,e,t=ye,s){const o={fn:r,state:t,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:i,owner:P,context:P?P.context:null,pure:e};return P===null||P!==wi&&(P.owned?P.owned.push(o):P.owned=[o]),o}function xt(r){if(r.state===0)return;if(r.state===mt)return yt(r);if(r.suspense&&qe(r.suspense.inFallback))return r.suspense.effects.push(r);const i=[r];for(;(r=r.owner)&&(!r.updatedAt||r.updatedAt<St);)r.state&&i.push(r);for(let e=i.length-1;e>=0;e--)if(r=i[e],r.state===ye)Qe(r);else if(r.state===mt){const t=G;G=null,Ze(()=>yt(r,i[0]),!1),G=t}}function Ze(r,i){if(G)return r();let e=!1;i||(G=[]),he?e=!0:he=[],St++;try{const t=r();return Ms(e),t}catch(t){e||(he=null),G=null,Ri(t)}}function Ms(r){if(G&&(bi(G),G=null),r)return;const i=he;he=null,i.length&&Ze(()=>vi(i),!1)}function bi(r){for(let i=0;i<r.length;i++)xt(r[i])}function Ls(r){let i,e=0;for(i=0;i<r.length;i++){const t=r[i];t.user?r[e++]=t:xt(t)}for(i=0;i<e;i++)xt(r[i])}function yt(r,i){r.state=0;for(let e=0;e<r.sources.length;e+=1){const t=r.sources[e];if(t.sources){const s=t.state;s===ye?t!==i&&(!t.updatedAt||t.updatedAt<St)&&xt(t):s===mt&&yt(t,i)}}}function Ci(r){for(let i=0;i<r.observers.length;i+=1){const e=r.observers[i];e.state||(e.state=mt,e.pure?G.push(e):he.push(e),e.observers&&Ci(e))}}function bt(r){let i;if(r.sources)for(;r.sources.length;){const e=r.sources.pop(),t=r.sourceSlots.pop(),s=e.observers;if(s&&s.length){const o=s.pop(),n=e.observerSlots.pop();t<s.length&&(o.sourceSlots[n]=t,s[t]=o,e.observerSlots[t]=n)}}if(r.owned){for(i=r.owned.length-1;i>=0;i--)bt(r.owned[i]);r.owned=null}if(r.cleanups){for(i=r.cleanups.length-1;i>=0;i--)r.cleanups[i]();r.cleanups=null}r.state=0}function ks(r){return r instanceof Error?r:new Error(typeof r=="string"?r:"Unknown error",{cause:r})}function Ri(r,i=P){throw ks(r)}function Ns(r,i){return qe(()=>r(i||{}))}function it(){return!0}const As={get(r,i,e){return i===Ot?e:r.get(i)},has(r,i){return i===Ot?!0:r.has(i)},set:it,deleteProperty:it,getOwnPropertyDescriptor(r,i){return{configurable:!0,enumerable:!0,get(){return r.get(i)},set:it,deleteProperty:it}},ownKeys(r){return r.keys()}};function Lt(r){return(r=typeof r=="function"?r():r)?r:{}}function zs(){for(let r=0,i=this.length;r<i;++r){const e=this[r]();if(e!==void 0)return e}}function Ii(...r){let i=!1;for(let n=0;n<r.length;n++){const l=r[n];i=i||!!l&&Ot in l,r[n]=typeof l=="function"?(i=!0,Ti(l)):l}if(i)return new Proxy({get(n){for(let l=r.length-1;l>=0;l--){const h=Lt(r[l])[n];if(h!==void 0)return h}},has(n){for(let l=r.length-1;l>=0;l--)if(n in Lt(r[l]))return!0;return!1},keys(){const n=[];for(let l=0;l<r.length;l++)n.push(...Object.keys(Lt(r[l])));return[...new Set(n)]}},As);const e={},t=Object.create(null);for(let n=r.length-1;n>=0;n--){const l=r[n];if(!l)continue;const h=Object.getOwnPropertyNames(l);for(let d=h.length-1;d>=0;d--){const f=h[d];if(f==="__proto__"||f==="constructor")continue;const u=Object.getOwnPropertyDescriptor(l,f);if(!t[f])t[f]=u.get?{enumerable:!0,configurable:!0,get:zs.bind(e[f]=[u.get.bind(l)])}:u.value!==void 0?u:void 0;else{const y=e[f];y&&(u.get?y.push(u.get.bind(l)):u.value!==void 0&&y.push(()=>u.value))}}}const s={},o=Object.keys(t);for(let n=o.length-1;n>=0;n--){const l=o[n],h=t[l];h&&h.get?Object.defineProperty(s,l,h):s[l]=h?h.value:void 0}return s}const Lr=void 0,[kr,Bs]=Cs(void 0);class Mi{constructor(i){a(this,"releaseCallback");this.releaseCallback=i}}class Fs extends Mi{constructor(e,t){var s,o;super(e);a(this,"textureMap",new Map);a(this,"zeroReferenceTextureSet",new Set);a(this,"options");this.options={textureCleanupIntervalMs:(s=t.textureCleanupIntervalMs)!=null?s:1e4,textureCleanupAgeThreadholdMs:(o=t.textureCleanupAgeThreadholdMs)!=null?o:6e4},setInterval(()=>{const n=Date.now(),l=this.options.textureCleanupAgeThreadholdMs;for(const h of this.zeroReferenceTextureSet)n-h.lastUpdate>l&&(this.releaseCallback(h.id),this.textureMap.delete(h.id),this.zeroReferenceTextureSet.delete(h))},this.options.textureCleanupIntervalMs)}registerTexture(e){var s;const t=(s=e.options)==null?void 0:s.id;if(M(t,"Texture must have an id to be registered"),!this.textureMap.has(t)){const o={id:t,nodeRefCount:0,lastUpdate:Date.now()};this.textureMap.set(t,o),this.zeroReferenceTextureSet.add(o)}}incrementTextureRefCount(e){var o;const t=(o=e.options)==null?void 0:o.id;M(t,"Texture must have an id to be registered");let s=this.textureMap.get(t);s||(this.registerTexture(e),s=this.textureMap.get(t)),M(s,"Texture must have been registered"),e.txType==="SubTexture"&&this.incrementTextureRefCount(e.props.texture),s.nodeRefCount++,s.lastUpdate=Date.now(),this.zeroReferenceTextureSet.has(s)&&this.zeroReferenceTextureSet.delete(s)}decrementTextureRefCount(e){var o;const t=(o=e.options)==null?void 0:o.id;M(t,"Texture must have an id to be registered");const s=this.textureMap.get(t);M(s,"Texture must have been registered"),s.nodeRefCount--,s.lastUpdate=Date.now(),s.nodeRefCount===0&&this.zeroReferenceTextureSet.add(s),e.txType==="SubTexture"&&this.decrementTextureRefCount(e.props.texture)}}class Ps extends Mi{constructor(e){super(e);a(this,"registry");this.registry=new FinalizationRegistry(e)}registerTexture(e){var t,s;M((t=e.options)==null?void 0:t.id,"Texture must have an ID to be registered"),this.registry.register(e,(s=e.options)==null?void 0:s.id)}incrementTextureRefCount(){}decrementTextureRefCount(){}}const De={alpha:r=>r===1?null:{prop:"opacity",value:"".concat(r)},x:r=>({prop:"left",value:"".concat(r,"px")}),y:r=>({prop:"top",value:"".concat(r,"px")}),width:r=>r===0?null:{prop:"width",value:"".concat(r,"px")},height:r=>r===0?null:{prop:"height",value:"".concat(r,"px")},zIndex:()=>"zIndex",fontFamily:()=>"font-family",fontSize:()=>"font-size",fontStyle:()=>"font-style",fontWeight:()=>"font-weight",fontStretch:()=>"font-stretch",lineHeight:()=>"line-height",letterSpacing:()=>"letter-spacing",textAlign:()=>"text-align",overflowSuffix:()=>"overflow-suffix",maxLines:()=>"max-lines",contain:()=>"contain",verticalAlign:()=>"vertical-align",clipping:r=>r===!1?null:{prop:"overflow",value:r?"hidden":"visible"},rotation:r=>r===0?null:{prop:"transform",value:"rotate(".concat(r,"rad)")},scale:r=>r===1?null:{prop:"transform",value:"scale(".concat(r,")")},scaleX:r=>r===1?null:{prop:"transform",value:"scaleX(".concat(r,")")},scaleY:r=>r===1?null:{prop:"transform",value:"scaleY(".concat(r,")")},color:r=>r===0?null:{prop:"color",value:Li(r)}},Li=r=>{const i=(r&255)/255,e=r>>8&255,t=r>>16&255,s=r>>24&255;return"rgba(".concat(s,",").concat(t,",").concat(e,",").concat(i,")")},Es={id:"id"};class Os{constructor(i,e){a(this,"root",null);a(this,"canvas",null);a(this,"height",1080);a(this,"width",1920);a(this,"scaleX",1);a(this,"scaleY",1);var o,n,l,h,d,f;if(ci())return;if(!e)throw new Error("settings is required");this.height=Math.ceil((n=e.appHeight)!=null?n:1080/((o=e.deviceLogicalPixelRatio)!=null?o:1)),this.width=Math.ceil((h=e.appWidth)!=null?h:1900/((l=e.deviceLogicalPixelRatio)!=null?l:1)),this.scaleX=(d=e.deviceLogicalPixelRatio)!=null?d:1,this.scaleY=(f=e.deviceLogicalPixelRatio)!=null?f:1,this.canvas=i,this.root=document.createElement("div"),this.setRootPosition(),document.body.appendChild(this.root),new MutationObserver(this.setRootPosition.bind(this)).observe(i,{attributes:!0,childList:!1,subtree:!1}),new ResizeObserver(this.setRootPosition.bind(this)).observe(i),window.addEventListener("resize",this.setRootPosition.bind(this)),console.warn("Inspector is enabled, this will impact performance")}setRootPosition(){if(this.root===null||this.canvas===null)return;const i=this.canvas.getBoundingClientRect(),e=document.documentElement.scrollTop+i.top,t=document.documentElement.scrollLeft+i.left;this.root.id="root",this.root.style.left="".concat(t,"px"),this.root.style.top="".concat(e,"px"),this.root.style.width="".concat(this.width,"px"),this.root.style.height="".concat(this.height,"px"),this.root.style.position="absolute",this.root.style.transformOrigin="0 0 0",this.root.style.transform="scale(".concat(this.scaleX,", ").concat(this.scaleY,")"),this.root.style.overflow="hidden",this.root.style.zIndex="65534"}createDiv(i,e){const t=document.createElement("div");t.style.position="absolute",t.id=i.id.toString();for(const s in e)this.updateNodeProperty(t,s,e[s]);return t}createNode(i,e){const t=i.createNode(e),s=this.createDiv(t,e);return s.node=t,t.div=s,this.createProxy(t,s)}createTextNode(i,e){const t=i.createTextNode(e),s=this.createDiv(t,e);return s.node=t,t.div=s,this.createProxy(t,s)}createProxy(i,e){return new Proxy(i,{set:(t,s,o)=>(this.updateNodeProperty(e,s,o),Reflect.set(t,s,o)),get:(t,s,o)=>(s==="destroy"&&this.destroyNode(t),s==="animate"?(n,l)=>{const h=t.animate(n,l);return new Proxy(h,{get:(d,f,u)=>(f==="start"&&this.animateNode(e,i,n,l),Reflect.get(d,f,u))})}:Reflect.get(t,s,o))})}destroyNode(i){const e=document.getElementById(i.id.toString());e==null||e.remove()}updateNodeProperty(i,e,t){var s;if(!(this.root===null||t===void 0||t===null)){if(e==="parent"){const o=t.id;if(o===1){this.root.appendChild(i);return}const n=document.getElementById(o.toString());n==null||n.appendChild(i);return}if(e==="text"){i.innerHTML=String(t),i.style.visibility="hidden";return}if(e==="src"&&t){i.setAttribute("data-src",String(t));return}if(De[e]){const o=(s=De[e])==null?void 0:s.call(De,t);if(o===null)return;if(typeof o=="string"){i.style.setProperty(o,String(t));return}typeof o=="object"&&i.style.setProperty(o.prop,o.value);return}if(Es[e]){i.setAttribute(String(De[e]),String(t));return}if(e==="data"){for(const o in t){const n=t[o];n===void 0?i.removeAttribute("data-".concat(o)):i.setAttribute("data-".concat(o),String(n))}return}}}animateNode(i,e,t,s){const{duration:o=1e3,delay:n=0}=s,{x:l,y:h,width:d,height:f,alpha:u=1,rotation:y=0,scale:x=1,color:w}=t;function _(){setTimeout(()=>{i.style.top="".concat(h,"px"),i.style.left="".concat(l,"px"),i.style.width="".concat(d,"px"),i.style.height="".concat(f,"px"),i.style.opacity="".concat(u),i.style.rotate="".concat(y,"rad"),i.style.scale="".concat(x),i.style.color=Li(w)},o)}setTimeout(_,n)}}function $s(r){return r.prototype instanceof Xi}async function Ds(r,i){let e;try{console.log("Loading core extension",r),e=await import(r)}catch(s){console.error("The core extension module at '".concat(r,"' could not be loaded.")),console.error(s);return}if(!e.default){console.error("The core extension module at '".concat(r,"' does not have a default export."));return}const t=e.default;if($s(t)){const s=new t;try{await s.run(i)}catch(o){console.error("The core extension at '".concat(r,"' threw an error.")),console.error(o)}}else console.error("The core extension at '".concat(r,"' does not extend CoreExtension."))}function ki(r){const i={boolean:!0,string:!0,number:!0,undefined:!0},e=Object.keys(r);for(let t=0;t<e.length;t++){const s=e[t];if(!s)continue;const o=r[s],n=typeof o;n==="string"&&o.length>2048&&(console.warn("Custom Data value for ".concat(s," is too long, it will be truncated to 2048 characters")),r[s]=o.substring(0,2048)),i[n]||(console.warn("Custom Data value for ".concat(s," is not a boolean, string, or number, it will be ignored")),delete r[s])}return r}class Ys extends Re{constructor(e,t,s){var R,g,p,c,v;super();a(this,"root",null);a(this,"driver");a(this,"canvas");a(this,"settings");a(this,"inspector",null);a(this,"nodes",new Map);a(this,"nextTextureId",1);a(this,"textureTracker");const o={appWidth:e.appWidth||1920,appHeight:e.appHeight||1080,txMemByteThreshold:e.txMemByteThreshold||124e6,boundsMargin:e.boundsMargin||0,deviceLogicalPixelRatio:e.deviceLogicalPixelRatio||1,devicePhysicalPixelRatio:e.devicePhysicalPixelRatio||window.devicePixelRatio,clearColor:(R=e.clearColor)!=null?R:0,coreExtensionModule:e.coreExtensionModule||null,experimental_FinalizationRegistryTextureUsageTracker:(g=e.experimental_FinalizationRegistryTextureUsageTracker)!=null?g:!1,textureCleanupOptions:e.textureCleanupOptions||{},fpsUpdateInterval:e.fpsUpdateInterval||0,numImageWorkers:e.numImageWorkers!==void 0?e.numImageWorkers:2,enableContextSpy:(p=e.enableContextSpy)!=null?p:!1,enableInspector:(c=e.enableInspector)!=null?c:!1,renderMode:(v=e.renderMode)!=null?v:"webgl"};this.settings=o;const{appWidth:n,appHeight:l,deviceLogicalPixelRatio:h,devicePhysicalPixelRatio:d,enableInspector:f}=o,u=I=>{this.driver.releaseTexture(I)},y=o.experimental_FinalizationRegistryTextureUsageTracker&&typeof FinalizationRegistry=="function";this.textureTracker=y?new Ps(u):new Fs(u,this.settings.textureCleanupOptions);const x=n*h,w=l*h;this.driver=s;const _=document.createElement("canvas");this.canvas=_,_.width=x*d,_.height=w*d,_.style.width="".concat(x,"px"),_.style.height="".concat(w,"px");let m;if(typeof t=="string"?m=document.getElementById(t):m=t,!m)throw new Error("Could not find target element");s.onCreateNode=I=>{this.nodes.set(I.id,I)},s.onBeforeDestroyNode=I=>{this.nodes.delete(I.id)},s.onFpsUpdate=I=>{this.emit("fpsUpdate",I)},s.onFrameTick=I=>{this.emit("frameTick",I)},s.onIdle=()=>{this.emit("idle")},m.appendChild(_),f&&!ci()&&(this.inspector=new Os(_,o))}async init(){await this.driver.init(this,this.settings,this.canvas),this.root=this.driver.getRootNode()}createNode(e){return this.inspector?this.inspector.createNode(this.driver,this.resolveNodeDefaults(e)):this.driver.createNode(this.resolveNodeDefaults(e))}createTextNode(e){var o,n,l,h,d,f,u,y,x,w,_,m,R,g,p,c,v,I,b;const t=(o=e.fontSize)!=null?o:16,s={...this.resolveNodeDefaults(e),text:(n=e.text)!=null?n:"",textRendererOverride:(l=e.textRendererOverride)!=null?l:null,fontSize:t,fontFamily:(h=e.fontFamily)!=null?h:"sans-serif",fontStyle:(d=e.fontStyle)!=null?d:"normal",fontWeight:(f=e.fontWeight)!=null?f:"normal",fontStretch:(u=e.fontStretch)!=null?u:"normal",textAlign:(y=e.textAlign)!=null?y:"left",contain:(x=e.contain)!=null?x:"none",scrollable:(w=e.scrollable)!=null?w:!1,scrollY:(_=e.scrollY)!=null?_:0,offsetY:(m=e.offsetY)!=null?m:0,letterSpacing:(R=e.letterSpacing)!=null?R:0,lineHeight:(g=e.lineHeight)!=null?g:t,maxLines:(p=e.maxLines)!=null?p:0,textBaseline:(c=e.textBaseline)!=null?c:"alphabetic",verticalAlign:(v=e.verticalAlign)!=null?v:"top",overflowSuffix:(I=e.overflowSuffix)!=null?I:"...",debug:(b=e.debug)!=null?b:{}};return this.inspector?this.inspector.createTextNode(this.driver,s):this.driver.createTextNode(s)}resolveNodeDefaults(e){var d,f,u,y,x,w,_,m,R,g,p,c,v,I,b,S,T,k,L,A,F,z,N,B,D,se,oe,Q,ce,de,Je,et,ve,re,Z,X,ue,fe,J,E,tt,pe,ge,we,Te,_e,Oe,$e;const t=(d=e.color)!=null?d:4294967295,s=(y=(u=(f=e.colorTl)!=null?f:e.colorTop)!=null?u:e.colorLeft)!=null?y:t,o=(_=(w=(x=e.colorTr)!=null?x:e.colorTop)!=null?w:e.colorRight)!=null?_:t,n=(g=(R=(m=e.colorBl)!=null?m:e.colorBottom)!=null?R:e.colorLeft)!=null?g:t,l=(v=(c=(p=e.colorBr)!=null?p:e.colorBottom)!=null?c:e.colorRight)!=null?v:t,h=ki((I=e.data)!=null?I:{});return{x:(b=e.x)!=null?b:0,y:(S=e.y)!=null?S:0,width:(T=e.width)!=null?T:0,height:(k=e.height)!=null?k:0,alpha:(L=e.alpha)!=null?L:1,autosize:(A=e.autosize)!=null?A:!1,clipping:(F=e.clipping)!=null?F:!1,color:t,colorTop:(z=e.colorTop)!=null?z:t,colorBottom:(N=e.colorBottom)!=null?N:t,colorLeft:(B=e.colorLeft)!=null?B:t,colorRight:(D=e.colorRight)!=null?D:t,colorBl:n,colorBr:l,colorTl:s,colorTr:o,zIndex:(se=e.zIndex)!=null?se:0,zIndexLocked:(oe=e.zIndexLocked)!=null?oe:0,parent:(Q=e.parent)!=null?Q:null,texture:(ce=e.texture)!=null?ce:null,shader:(de=e.shader)!=null?de:null,src:(Je=e.src)!=null?Je:"",scale:(et=e.scale)!=null?et:null,scaleX:(re=(ve=e.scaleX)!=null?ve:e.scale)!=null?re:1,scaleY:(X=(Z=e.scaleY)!=null?Z:e.scale)!=null?X:1,mount:(ue=e.mount)!=null?ue:0,mountX:(J=(fe=e.mountX)!=null?fe:e.mount)!=null?J:0,mountY:(tt=(E=e.mountY)!=null?E:e.mount)!=null?tt:0,pivot:(pe=e.pivot)!=null?pe:.5,pivotX:(we=(ge=e.pivotX)!=null?ge:e.pivot)!=null?we:.5,pivotY:(_e=(Te=e.pivotY)!=null?Te:e.pivot)!=null?_e:.5,rotation:(Oe=e.rotation)!=null?Oe:0,rtt:($e=e.rtt)!=null?$e:!1,data:h}}destroyNode(e){return this.inspector&&this.inspector.destroyNode(e),this.driver.destroyNode(e)}createTexture(e,t,s){const o=this.nextTextureId++,n={descType:"texture",txType:e,props:t,options:{...s,id:o}};return this.textureTracker.registerTexture(n),n}createShader(e,t){return{descType:"shader",shType:e,props:t}}getNodeById(e){return this.nodes.get(e)||null}toggleFreeze(){throw new Error("Not implemented")}advanceFrame(){throw new Error("Not implemented")}rerender(){throw new Error("Not implemented")}}class Ws extends Re{constructor(e,t,s){super();a(this,"node");a(this,"props");a(this,"settings");a(this,"propStartValues",{});a(this,"restoreValues",{});a(this,"progress",0);a(this,"delayFor",0);a(this,"timingFunction");a(this,"propsList");this.node=e,this.props=t,this.settings=s,this.propStartValues={},this.propsList=Object.keys(t),this.propsList.forEach(o=>{this.propStartValues[o]=e[o]}),this.timingFunction=o=>o,s.easing&&typeof s.easing=="string"&&(this.timingFunction=Vi(s.easing)),this.delayFor=s.delay||0}reset(){this.progress=0,this.delayFor=this.settings.delay||0,this.update(0)}restore(){this.reset(),Object.keys(this.props).forEach(e=>{this.node[e]=this.propStartValues[e]})}reverse(){this.progress=0,Object.keys(this.props).forEach(e=>{const t=this.props[e],s=this.propStartValues[e];this.props[e]=s,this.propStartValues[e]=t}),this.settings.loop||(this.settings.stopMethod=!1)}applyEasing(e,t,s){return(this.timingFunction(e)||e)*(s-t)+t}update(e){const{duration:t,loop:s,easing:o,stopMethod:n}=this.settings;if(!t){this.emit("finished",{});return}if(this.delayFor>0){this.delayFor-=e;return}if(this.delayFor<=0&&this.progress===0&&this.emit("start",{}),this.progress+=e/t,this.progress>1&&(this.progress=s?0:1,n)){this.emit("finished",{});return}for(let l=0;l<this.propsList.length;l++){const h=this.propsList[l],d=this.props[h],f=this.propStartValues[h],u=d;if(h.indexOf("color")!==-1){if(f===u){this.node[h]=f;continue}if(o){const y=this.timingFunction(this.progress)||this.progress,x=jt(f,u,y);this.node[h]=x;continue}this.node[h]=jt(f,u,this.progress);continue}if(o){this.node[h]=this.applyEasing(this.progress,f,u);continue}this.node[h]=f+(u-f)*this.progress}this.progress===1&&this.emit("finished",{})}}class Us{constructor(i,e){a(this,"manager");a(this,"animation");a(this,"startedPromise",null);a(this,"startedResolve",null);a(this,"stoppedPromise",null);a(this,"stoppedResolve",null);a(this,"state");this.manager=i,this.animation=e,this.state="stopped"}start(){return this.makeStartedPromise(),this.animation.once("start",this.started.bind(this)),this.makeStoppedPromise(),this.animation.once("finished",this.finished.bind(this)),this.manager.activeAnimations.has(this.animation)||this.manager.registerAnimation(this.animation),this.state="running",this}stop(){return this.manager.unregisterAnimation(this.animation),this.stoppedResolve!==null&&(this.stoppedResolve(),this.stoppedResolve=null),this.animation.reset(),this.state="stopped",this}pause(){return this.manager.unregisterAnimation(this.animation),this.state="paused",this}restore(){return this.stoppedResolve=null,this.animation.restore(),this}waitUntilStarted(){this.makeStartedPromise();const i=this.startedPromise;return M(i),i}waitUntilStopped(){this.makeStoppedPromise();const i=this.stoppedPromise;return M(i),i}makeStartedPromise(){this.startedResolve===null&&(this.startedPromise=new Promise(i=>{this.startedResolve=i}))}makeStoppedPromise(){this.stoppedResolve===null&&(this.stoppedPromise=new Promise(i=>{this.stoppedResolve=i}))}started(){M(this.startedResolve),this.startedResolve(this),this.startedResolve=null}finished(){M(this.stoppedResolve);const{loop:i,stopMethod:e}=this.animation.settings;if(e==="reverse"){this.animation.reverse(),this.start();return}this.stoppedResolve(),this.stoppedResolve=null,!i&&this.manager.unregisterAnimation(this.animation)}}const Y=0,W=3,j=6,O=1,U=4,K=7,ee=2,te=5,ie=8;class q{constructor(i){a(this,"data");i?(this.data=new Float32Array(9),this.data[Y]=i[0],this.data[W]=i[3],this.data[j]=i[6],this.data[O]=i[1],this.data[U]=i[4],this.data[K]=i[7],this.data[ee]=i[2],this.data[te]=i[5],this.data[ie]=i[8]):this.data=new Float32Array(9)}static get temp(){return Hs}static multiply(i,e,t){const s=i.data[Y]*e.data[Y]+i.data[W]*e.data[O]+i.data[j]*e.data[ee],o=i.data[Y]*e.data[W]+i.data[W]*e.data[U]+i.data[j]*e.data[te],n=i.data[Y]*e.data[j]+i.data[W]*e.data[K]+i.data[j]*e.data[ie],l=i.data[O]*e.data[Y]+i.data[U]*e.data[O]+i.data[K]*e.data[ee],h=i.data[O]*e.data[W]+i.data[U]*e.data[U]+i.data[K]*e.data[te],d=i.data[O]*e.data[j]+i.data[U]*e.data[K]+i.data[K]*e.data[ie],f=i.data[ee]*e.data[Y]+i.data[te]*e.data[O]+i.data[ie]*e.data[ee],u=i.data[ee]*e.data[W]+i.data[te]*e.data[U]+i.data[ie]*e.data[te],y=i.data[ee]*e.data[j]+i.data[te]*e.data[K]+i.data[ie]*e.data[ie];return t||(t=new q),t.data[Y]=s,t.data[W]=o,t.data[j]=n,t.data[O]=l,t.data[U]=h,t.data[K]=d,t.data[ee]=f,t.data[te]=u,t.data[ie]=y,t}static identity(i){return i||(i=new q),i.data[Y]=1,i.data[W]=0,i.data[j]=0,i.data[O]=0,i.data[U]=1,i.data[K]=0,i.data[ee]=0,i.data[te]=0,i.data[ie]=1,i}static translate(i,e,t){return t||(t=new q),t.data[Y]=1,t.data[W]=0,t.data[j]=i,t.data[O]=0,t.data[U]=1,t.data[K]=e,t.data[ee]=0,t.data[te]=0,t.data[ie]=1,t}static scale(i,e,t){return t||(t=new q),t.data[Y]=i,t.data[W]=0,t.data[j]=0,t.data[O]=0,t.data[U]=e,t.data[K]=0,t.data[ee]=0,t.data[te]=0,t.data[ie]=1,t}static rotate(i,e){const t=Math.cos(i),s=Math.sin(i);return e||(e=new q),e.data[Y]=t,e.data[W]=-s,e.data[j]=0,e.data[O]=s,e.data[U]=t,e.data[K]=0,e.data[ee]=0,e.data[te]=0,e.data[ie]=1,e}static copy(i,e,t){return e||(e=new q),e.data[0]=i.data[0],e.data[1]=i.data[1],e.data[2]=i.data[2],e.data[3]=i.data[3],e.data[4]=i.data[4],e.data[5]=i.data[5],e.data[6]=i.data[6],e.data[7]=i.data[7],e.data[8]=i.data[8],e}translate(i,e){return this.data[j]=this.data[Y]*i+this.data[W]*e+this.data[j],this.data[K]=this.data[O]*i+this.data[U]*e+this.data[K],this}scale(i,e){return this.data[Y]=this.data[Y]*i,this.data[W]=this.data[W]*e,this.data[O]=this.data[O]*i,this.data[U]=this.data[U]*e,this}rotate(i){if(i===0||!(i%Math.PI*2))return this;const e=Math.cos(i),t=Math.sin(i),s=this.data[Y]*e+this.data[W]*t,o=this.data[W]*e-this.data[Y]*t,n=this.data[O]*e+this.data[U]*t,l=this.data[U]*e-this.data[O]*t;return this.data[Y]=s,this.data[W]=o,this.data[O]=n,this.data[U]=l,this}multiply(i){return q.multiply(this,i,this)}get tx(){return this.data[j]}get ty(){return this.data[K]}get ta(){return this.data[Y]}get tb(){return this.data[W]}get tc(){return this.data[O]}get td(){return this.data[U]}transformPoint(i,e){return[this.data[Y]*i+this.data[W]*e+this.data[j],this.data[O]*i+this.data[U]*e+this.data[O]]}}const Hs=new q,st=0,rt=2,ot=4,nt=6,at=1,lt=3,ht=5,ct=7;class vt{constructor(i){a(this,"data");this.data=new Float32Array(8),i&&(this.data[st]=i[st],this.data[rt]=i[rt],this.data[ot]=i[ot],this.data[nt]=i[nt],this.data[at]=i[at],this.data[lt]=i[lt],this.data[ht]=i[ht],this.data[ct]=i[ct])}static translate(i,e,t,s,o,n,l,h,d){return d||(d=new vt),d.data[st]=i,d.data[rt]=t,d.data[ot]=o,d.data[nt]=l,d.data[at]=e,d.data[lt]=s,d.data[ht]=n,d.data[ct]=h,d}get x1(){return this.data[st]}get x2(){return this.data[rt]}get x3(){return this.data[ot]}get x4(){return this.data[nt]}get y1(){return this.data[at]}get y2(){return this.data[lt]}get y3(){return this.data[ht]}get y4(){return this.data[ct]}}var $;(function(r){r[r.Init=0]="Init",r[r.OutOfBounds=2]="OutOfBounds",r[r.InBounds=4]="InBounds",r[r.InViewport=8]="InViewport"})($||($={}));const Ce=new Map;Ce.set($.Init,"init");Ce.set($.OutOfBounds,"outOfBounds");Ce.set($.InBounds,"inBounds");Ce.set($.InViewport,"inViewport");var C;(function(r){r[r.Children=1]="Children",r[r.ScaleRotate=2]="ScaleRotate",r[r.Local=4]="Local",r[r.Global=8]="Global",r[r.Clipping=16]="Clipping",r[r.CalculatedZIndex=32]="CalculatedZIndex",r[r.ZIndexSortedChildren=64]="ZIndexSortedChildren",r[r.PremultipliedColors=128]="PremultipliedColors",r[r.WorldAlpha=256]="WorldAlpha",r[r.RenderState=512]="RenderState",r[r.IsRenderable=1024]="IsRenderable",r[r.RenderTexture=2048]="RenderTexture",r[r.ParentRenderTexture=4096]="ParentRenderTexture",r[r.None=0]="None",r[r.All=8191]="All"})(C||(C={}));class Ut extends Re{constructor(e,t){super();a(this,"stage");a(this,"children",[]);a(this,"props");a(this,"updateType",C.All);a(this,"globalTransform");a(this,"scaleRotateTransform");a(this,"localTransform");a(this,"renderCoords");a(this,"renderBound");a(this,"strictBound");a(this,"preloadBound");a(this,"clippingRect",{x:0,y:0,width:0,height:0,valid:!1});a(this,"isRenderable",!1);a(this,"renderState",$.Init);a(this,"worldAlpha",1);a(this,"premultipliedColorTl",0);a(this,"premultipliedColorTr",0);a(this,"premultipliedColorBl",0);a(this,"premultipliedColorBr",0);a(this,"calcZIndex",0);a(this,"hasRTTupdates",!1);a(this,"parentHasRenderTexture",!1);a(this,"onTextureLoaded",(e,t)=>{this.autosizeNode(t),this.stage.requestRender(),this.parentHasRenderTexture&&this.setRTTUpdates(1),this.emit("loaded",{type:"texture",dimensions:t})});a(this,"onTextureFailed",(e,t)=>{this.emit("failed",{type:"texture",error:t})});a(this,"onTextureFreed",e=>{this.emit("freed",{type:"texture"})});this.stage=e,this.props={...t,parent:null},this.parent=t.parent,this.rtt=t.rtt,this.updateScaleRotateTransform()}loadTexture(e,t,s=null){this.props.texture&&this.unloadTexture();const{txManager:o}=this.stage,n=o.loadTexture(e,t,s);this.props.texture=n,this.props.textureOptions=s,this.setUpdateType(C.IsRenderable),queueMicrotask(()=>{n.state==="loaded"?this.onTextureLoaded(n,n.dimensions):n.state==="failed"?this.onTextureFailed(n,n.error):n.state==="freed"&&this.onTextureFreed(n),n.on("loaded",this.onTextureLoaded),n.on("failed",this.onTextureFailed),n.on("freed",this.onTextureFreed)})}unloadTexture(){if(this.props.texture){const{texture:e}=this.props;e.off("loaded",this.onTextureLoaded),e.off("failed",this.onTextureFailed),e.off("freed",this.onTextureFreed),e.setRenderableOwner(this,!1)}this.props.texture=null,this.props.textureOptions=null,this.setUpdateType(C.IsRenderable)}autosizeNode(e){this.autosize&&(this.width=e.width,this.height=e.height)}loadShader(e,t){const s=this.stage.renderer.getShaderManager();M(s);const{shader:o,props:n}=s.loadShader(e,t);this.props.shader=o,this.props.shaderProps=n,this.setUpdateType(C.IsRenderable)}setUpdateType(e){this.updateType|=e;const t=this.props.parent;t&&!(t.updateType&C.Children)&&t.setUpdateType(C.Children),this.parentHasRenderTexture&&this.setRTTUpdates(e)}sortChildren(){this.children.sort((e,t)=>e.calcZIndex-t.calcZIndex)}updateScaleRotateTransform(){this.scaleRotateTransform=q.rotate(this.props.rotation,this.scaleRotateTransform).scale(this.props.scaleX,this.props.scaleY)}updateLocalTransform(){M(this.scaleRotateTransform);const e=this.props.pivotX*this.props.width,t=this.props.pivotY*this.props.height,s=this.props.mountX*this.props.width,o=this.props.mountY*this.props.height;this.localTransform=q.translate(e-s+this.props.x,t-o+this.props.y,this.localTransform).multiply(this.scaleRotateTransform).translate(-e,-t),this.setUpdateType(C.Global)}update(e,t){var n;this.updateType&C.ScaleRotate&&(this.updateScaleRotateTransform(),this.setUpdateType(C.Local)),this.updateType&C.Local&&(this.updateLocalTransform(),this.setUpdateType(C.Global));const s=this.props.parent;let o=C.None;if(this.updateType&C.ParentRenderTexture){let l=this.parent;for(;l;)l.rtt&&(this.parentHasRenderTexture=!0),l=l.parent}this.updateType^C.All&&this.updateType&C.RenderTexture&&this.children.forEach(l=>{l.setUpdateType(C.All)}),this.updateType&C.Global&&(M(this.localTransform),this.globalTransform=q.copy((s==null?void 0:s.globalTransform)||this.localTransform,this.globalTransform),this.parentHasRenderTexture&&((n=this.props.parent)!=null&&n.rtt)&&(this.globalTransform=q.identity()),s&&this.globalTransform.multiply(this.localTransform),this.calculateRenderCoords(),this.updateBoundingRect(),this.setUpdateType(C.Clipping|C.RenderState|C.Children),o|=C.Global),this.updateType&C.Clipping&&(this.calculateClippingRect(t),this.setUpdateType(C.Children),o|=C.Clipping),this.updateType&C.WorldAlpha&&(s?this.worldAlpha=s.worldAlpha*this.props.alpha:this.worldAlpha=this.props.alpha,this.setUpdateType(C.Children|C.PremultipliedColors|C.IsRenderable),o|=C.WorldAlpha),this.updateType&C.PremultipliedColors&&(this.premultipliedColorTl=We(this.props.colorTl,this.worldAlpha,!0),this.props.colorTl===this.props.colorTr&&this.props.colorBl===this.props.colorBr&&this.props.colorTl===this.props.colorBl?this.premultipliedColorTr=this.premultipliedColorBl=this.premultipliedColorBr=this.premultipliedColorTl:(this.premultipliedColorTr=We(this.props.colorTr,this.worldAlpha,!0),this.premultipliedColorBl=We(this.props.colorBl,this.worldAlpha,!0),this.premultipliedColorBr=We(this.props.colorBr,this.worldAlpha,!0))),this.updateType&C.RenderState&&(this.updateRenderState(t),this.setUpdateType(C.IsRenderable)),this.updateType&C.IsRenderable&&this.updateIsRenderable(),s&&this.updateType&C.CalculatedZIndex&&(this.calculateZIndex(),s.setUpdateType(C.ZIndexSortedChildren)),this.updateType&C.Children&&this.children.length&&!this.rtt&&this.children.forEach(l=>{l.setUpdateType(o),l.updateType!==0&&l.update(e,this.clippingRect)}),this.updateType&C.ZIndexSortedChildren&&this.sortChildren(),this.updateType=0}checkRenderProps(){return this.props.texture?!0:!this.props.width||!this.props.height?!1:!!(this.props.shader||this.props.clipping||this.props.color!==0||this.props.colorTop!==0||this.props.colorBottom!==0||this.props.colorLeft!==0||this.props.colorRight!==0||this.props.colorTl!==0||this.props.colorTr!==0||this.props.colorBl!==0||this.props.colorBr!==0)}checkRenderBounds(e){M(this.renderBound);const t=e.width||this.stage.root.width,s=e.height||this.stage.root.height;this.strictBound=Be(e.x,e.y,e.x+t,e.y+s,this.strictBound);const o=this.stage.boundsMargin;return this.preloadBound=Be(e.x-o[3],e.y-o[0],e.x+t+o[1],e.y+s+o[2],this.preloadBound),Gt(this.renderBound,this.strictBound)?$.InViewport:Gt(this.renderBound,this.preloadBound)?$.InBounds:$.OutOfBounds}updateRenderState(e){const t=this.checkRenderBounds(e);if(t!==this.renderState){let s=this.renderState;this.renderState=t,s===$.InViewport&&this.emit("outOfViewport",{previous:s,current:t}),s<$.InBounds&&t===$.InViewport?(this.emit(Ce.get($.InBounds),{previous:s,current:t}),s=$.InBounds):s>$.InBounds&&t===$.OutOfBounds&&(this.emit(Ce.get($.InBounds),{previous:s,current:t}),s=$.InBounds);const o=Ce.get(t);M(o),this.emit(o,{previous:s,current:t})}}setRenderState(e){e!==this.renderState&&(this.renderState=e,this.emit($[e]))}updateIsRenderable(){let e;this.worldAlpha===0||!this.checkRenderProps()?e=!1:e=this.renderState>$.OutOfBounds,this.isRenderable!==e&&(this.isRenderable=e,this.onChangeIsRenderable(e))}onChangeIsRenderable(e){var t;(t=this.props.texture)==null||t.setRenderableOwner(this,e)}calculateRenderCoords(){const{width:e,height:t,globalTransform:s}=this;M(s);const{tx:o,ty:n,ta:l,tb:h,tc:d,td:f}=s;if(h===0&&d===0){const u=o,y=o+e*l,x=n,w=n+t*f;this.renderCoords=vt.translate(u,x,y,x,y,w,u,w,this.renderCoords)}else this.renderCoords=vt.translate(o,n,o+e*l,n+e*d,o+e*l+t*h,n+e*d+t*f,o+t*h,n+t*f,this.renderCoords)}updateBoundingRect(){const{renderCoords:e,globalTransform:t}=this;M(t),M(e);const{tb:s,tc:o}=t,{x1:n,y1:l,x3:h,y3:d}=e;if(s===0||o===0)this.renderBound=Be(n,l,h,d,this.renderBound);else{const{x2:f,x4:u,y2:y,y4:x}=e;this.renderBound=Be(Math.min(n,f,h,u),Math.min(l,y,d,x),Math.max(n,f,h,u),Math.max(l,y,d,x),this.renderBound)}}calculateClippingRect(e){M(this.globalTransform);const{clippingRect:t,props:s,globalTransform:o}=this,{clipping:n}=s,l=o.tb!==0||o.tc!==0;n&&!l?(t.x=o.tx,t.y=o.ty,t.width=this.width*o.ta,t.height=this.height*o.td,t.valid=!0):t.valid=!1,e.valid&&t.valid?Yt(e,t,t):e.valid&&(hi(e,t),t.valid=!0)}calculateZIndex(){var n,l;const e=this.props,t=e.zIndex||0,s=((n=e.parent)==null?void 0:n.zIndex)||0;let o=t;(l=e.parent)!=null&&l.zIndexLocked&&(o=t<s?t:s),this.calcZIndex=o}destroy(){this.unloadTexture(),this.clippingRect.valid=!1,this.isRenderable=!1,delete this.renderCoords,delete this.renderBound,delete this.strictBound,delete this.preloadBound,delete this.globalTransform,delete this.scaleRotateTransform,delete this.localTransform,this.props.texture=null,this.props.shader=null,this.rtt&&this.stage.renderer.removeRTTNode(this),this.removeAllListeners(),this.parent=null}renderQuads(e){const{width:t,height:s,texture:o,textureOptions:n,shader:l,shaderProps:h,rtt:d}=this.props;if(this.parentHasRenderTexture&&(!e.renderToTextureActive||this.parentRenderTexture!==e.activeRttNode))return;const{premultipliedColorTl:f,premultipliedColorTr:u,premultipliedColorBl:y,premultipliedColorBr:x}=this,{zIndex:w,worldAlpha:_,globalTransform:m,clippingRect:R}=this;M(m),e.addQuad({width:t,height:s,colorTl:f,colorTr:u,colorBl:y,colorBr:x,texture:o,textureOptions:n,zIndex:w,shader:l,shaderProps:h,alpha:_,clippingRect:R,tx:m.tx,ty:m.ty,ta:m.ta,tb:m.tb,tc:m.tc,td:m.td,rtt:d,parentHasRenderTexture:this.parentHasRenderTexture,framebufferDimensions:this.framebufferDimensions})}get id(){return this.props.id}get x(){return this.props.x}set x(e){this.props.x!==e&&(this.props.x=e,this.setUpdateType(C.Local))}get absX(){var e,t,s;return this.props.x+(((e=this.props.parent)==null?void 0:e.absX)||((s=(t=this.props.parent)==null?void 0:t.globalTransform)==null?void 0:s.tx)||0)}get absY(){var e,t;return this.props.y+((t=(e=this.props.parent)==null?void 0:e.absY)!=null?t:0)}get y(){return this.props.y}set y(e){this.props.y!==e&&(this.props.y=e,this.setUpdateType(C.Local))}get width(){return this.props.width}set width(e){this.props.width!==e&&(this.props.width=e,this.setUpdateType(C.Local),this.props.rtt&&this.setUpdateType(C.RenderTexture))}get height(){return this.props.height}set height(e){this.props.height!==e&&(this.props.height=e,this.setUpdateType(C.Local),this.props.rtt&&this.setUpdateType(C.RenderTexture))}get scale(){return this.scaleX}set scale(e){this.scaleX=e,this.scaleY=e}get scaleX(){return this.props.scaleX}set scaleX(e){this.props.scaleX!==e&&(this.props.scaleX=e,this.setUpdateType(C.ScaleRotate))}get scaleY(){return this.props.scaleY}set scaleY(e){this.props.scaleY!==e&&(this.props.scaleY=e,this.setUpdateType(C.ScaleRotate))}get mount(){return this.props.mount}set mount(e){(this.props.mountX!==e||this.props.mountY!==e)&&(this.props.mountX=e,this.props.mountY=e,this.props.mount=e,this.setUpdateType(C.Local))}get mountX(){return this.props.mountX}set mountX(e){this.props.mountX!==e&&(this.props.mountX=e,this.setUpdateType(C.Local))}get mountY(){return this.props.mountY}set mountY(e){this.props.mountY!==e&&(this.props.mountY=e,this.setUpdateType(C.Local))}get pivot(){return this.props.pivot}set pivot(e){(this.props.pivotX!==e||this.props.pivotY!==e)&&(this.props.pivotX=e,this.props.pivotY=e,this.props.pivot=e,this.setUpdateType(C.Local))}get pivotX(){return this.props.pivotX}set pivotX(e){this.props.pivotX!==e&&(this.props.pivotX=e,this.setUpdateType(C.Local))}get pivotY(){return this.props.pivotY}set pivotY(e){this.props.pivotY!==e&&(this.props.pivotY=e,this.setUpdateType(C.Local))}get rotation(){return this.props.rotation}set rotation(e){this.props.rotation!==e&&(this.props.rotation=e,this.setUpdateType(C.ScaleRotate))}get alpha(){return this.props.alpha}set alpha(e){this.props.alpha=e,this.setUpdateType(C.PremultipliedColors|C.WorldAlpha)}get autosize(){return this.props.autosize}set autosize(e){this.props.autosize=e}get clipping(){return this.props.clipping}set clipping(e){this.props.clipping=e,this.setUpdateType(C.Clipping)}get color(){return this.props.color}set color(e){(this.props.colorTl!==e||this.props.colorTr!==e||this.props.colorBl!==e||this.props.colorBr!==e)&&(this.colorTl=e,this.colorTr=e,this.colorBl=e,this.colorBr=e),this.props.color=e,this.setUpdateType(C.PremultipliedColors)}get colorTop(){return this.props.colorTop}set colorTop(e){(this.props.colorTl!==e||this.props.colorTr!==e)&&(this.colorTl=e,this.colorTr=e),this.props.colorTop=e,this.setUpdateType(C.PremultipliedColors)}get colorBottom(){return this.props.colorBottom}set colorBottom(e){(this.props.colorBl!==e||this.props.colorBr!==e)&&(this.colorBl=e,this.colorBr=e),this.props.colorBottom=e,this.setUpdateType(C.PremultipliedColors)}get colorLeft(){return this.props.colorLeft}set colorLeft(e){(this.props.colorTl!==e||this.props.colorBl!==e)&&(this.colorTl=e,this.colorBl=e),this.props.colorLeft=e,this.setUpdateType(C.PremultipliedColors)}get colorRight(){return this.props.colorRight}set colorRight(e){(this.props.colorTr!==e||this.props.colorBr!==e)&&(this.colorTr=e,this.colorBr=e),this.props.colorRight=e,this.setUpdateType(C.PremultipliedColors)}get colorTl(){return this.props.colorTl}set colorTl(e){this.props.colorTl=e,this.setUpdateType(C.PremultipliedColors)}get colorTr(){return this.props.colorTr}set colorTr(e){this.props.colorTr=e,this.setUpdateType(C.PremultipliedColors)}get colorBl(){return this.props.colorBl}set colorBl(e){this.props.colorBl=e,this.setUpdateType(C.PremultipliedColors)}get colorBr(){return this.props.colorBr}set colorBr(e){this.props.colorBr=e,this.setUpdateType(C.PremultipliedColors)}get zIndexLocked(){return this.props.zIndexLocked||0}set zIndexLocked(e){this.props.zIndexLocked=e,this.setUpdateType(C.CalculatedZIndex|C.Children),this.children.forEach(t=>{t.setUpdateType(C.CalculatedZIndex)})}get zIndex(){return this.props.zIndex}set zIndex(e){this.props.zIndex=e,this.setUpdateType(C.CalculatedZIndex|C.Children),this.children.forEach(t=>{t.setUpdateType(C.CalculatedZIndex)})}get parent(){return this.props.parent}set parent(e){const t=this.props.parent;if(t!==e){if(this.props.parent=e,t){const s=t.children.indexOf(this);M(s!==-1,"CoreNode.parent: Node not found in old parent's children!"),t.children.splice(s,1),t.setUpdateType(C.Children|C.ZIndexSortedChildren)}e&&(e.children.push(this),this.setUpdateType(C.All),e.setUpdateType(C.Children|C.ZIndexSortedChildren),(e.rtt||e.parentHasRenderTexture)&&this.setRTTUpdates(C.All)),this.updateScaleRotateTransform()}}get rtt(){return this.props.rtt}set rtt(e){var t,s;if(!e){this.props.rtt&&(this.props.rtt=!1,this.unloadTexture(),this.setUpdateType(C.All),this.children.forEach(o=>{o.parentHasRenderTexture=!1}),(t=this.stage.renderer)==null||t.removeRTTNode(this));return}this.props.rtt=!0,this.hasRTTupdates=!0,this.setUpdateType(C.All),this.children.forEach(o=>{o.setUpdateType(C.All)}),(s=this.stage.renderer)==null||s.renderToTexture(this)}get framebufferDimensions(){return this.parentHasRenderTexture&&!this.rtt&&this.parent?this.parent.framebufferDimensions:{width:this.width,height:this.height}}get parentRenderTexture(){let e=this.parent;for(;e;){if(e.rtt)return e;e=e.parent}return null}get texture(){return this.props.texture}setRTTUpdates(e){var t;this.hasRTTupdates=!0,(t=this.parent)==null||t.setRTTUpdates(e)}}let Xs=1;function Ht(){return Xs++}class $t extends Re{constructor(e,t,s,o){var n;super();a(this,"rendererMain");a(this,"stage");a(this,"id");a(this,"coreNode");a(this,"_children",[]);a(this,"_src","");a(this,"_parent",null);a(this,"_texture",null);a(this,"_shader",null);a(this,"_data",{});a(this,"onTextureLoaded",(e,t)=>{this.emit("loaded",t)});a(this,"onTextureFailed",(e,t)=>{this.emit("failed",t)});a(this,"onTextureFreed",(e,t)=>{this.emit("freed",t)});a(this,"onOutOfBounds",(e,t)=>{this.emit("outOfBounds",t)});a(this,"onInBounds",(e,t)=>{this.emit("inBounds",t)});a(this,"onOutOfViewport",(e,t)=>{this.emit("outOfViewport",t)});a(this,"onInViewport",(e,t)=>{this.emit("inViewport",t)});this.rendererMain=t,this.stage=s,this.id=(n=o==null?void 0:o.id)!=null?n:Ht(),this.coreNode=o||new Ut(this.stage,{id:this.id,x:e.x,y:e.y,width:e.width,height:e.height,alpha:e.alpha,autosize:e.autosize,clipping:e.clipping,color:e.color,colorTop:e.colorTop,colorBottom:e.colorBottom,colorLeft:e.colorLeft,colorRight:e.colorRight,colorTl:e.colorTl,colorTr:e.colorTr,colorBl:e.colorBl,colorBr:e.colorBr,zIndex:e.zIndex,zIndexLocked:e.zIndexLocked,scaleX:e.scaleX,scaleY:e.scaleY,mountX:e.mountX,mountY:e.mountY,mount:e.mount,pivot:e.pivot,pivotX:e.pivotX,pivotY:e.pivotY,rotation:e.rotation,parent:null,shader:null,shaderProps:null,texture:null,textureOptions:null,rtt:e.rtt}),this.coreNode.on("loaded",this.onTextureLoaded),this.coreNode.on("failed",this.onTextureFailed),this.coreNode.on("freed",this.onTextureFreed),this.coreNode.on("outOfBounds",this.onOutOfBounds),this.coreNode.on("inBounds",this.onInBounds),this.coreNode.on("outOfViewport",this.onOutOfViewport),this.coreNode.on("inViewport",this.onInViewport),this.parent=e.parent,this.shader=e.shader,this.texture=e.texture,this.src=e.src,this.rtt=e.rtt,this._data=e.data}get x(){return this.coreNode.x}set x(e){this.coreNode.x=e}get y(){return this.coreNode.y}set y(e){this.coreNode.y=e}get width(){return this.coreNode.width}set width(e){e!==this.coreNode.width&&this.coreNode.rtt&&(this.texture=this.rendererMain.createTexture("RenderTexture",{width:this.width,height:this.height},{preload:!0,flipY:!0})),this.coreNode.width=e}get height(){return this.coreNode.height}set height(e){e!==this.coreNode.height&&this.coreNode.rtt&&(this.texture=this.rendererMain.createTexture("RenderTexture",{width:this.width,height:this.height},{preload:!0,flipY:!0})),this.coreNode.height=e}get alpha(){return this.coreNode.alpha}set alpha(e){this.coreNode.alpha=e}get autosize(){return this.coreNode.autosize}set autosize(e){this.coreNode.autosize=e}get clipping(){return this.coreNode.clipping}set clipping(e){this.coreNode.clipping=e}get color(){return this.coreNode.color}set color(e){this.coreNode.color=e}get colorTop(){return this.coreNode.colorTop}set colorTop(e){this.coreNode.colorTop=e}get colorBottom(){return this.coreNode.colorBottom}set colorBottom(e){this.coreNode.colorBottom=e}get colorLeft(){return this.coreNode.colorLeft}set colorLeft(e){this.coreNode.colorLeft=e}get colorRight(){return this.coreNode.colorRight}set colorRight(e){this.coreNode.colorRight=e}get colorTl(){return this.coreNode.colorTl}set colorTl(e){this.coreNode.colorTl=e}get colorTr(){return this.coreNode.colorTr}set colorTr(e){this.coreNode.colorTr=e}get colorBl(){return this.coreNode.colorBl}set colorBl(e){this.coreNode.colorBl=e}get colorBr(){return this.coreNode.colorBr}set colorBr(e){this.coreNode.colorBr=e}get scale(){return this.scaleX!==this.scaleY?null:this.coreNode.scaleX}set scale(e){e!==null&&(this.coreNode.scaleX=e,this.coreNode.scaleY=e)}get scaleX(){return this.coreNode.scaleX}set scaleX(e){this.coreNode.scaleX=e}get scaleY(){return this.coreNode.scaleY}set scaleY(e){this.coreNode.scaleY=e}get mount(){return this.coreNode.mount}set mount(e){this.coreNode.mount=e}get mountX(){return this.coreNode.mountX}set mountX(e){this.coreNode.mountX=e}get mountY(){return this.coreNode.mountY}set mountY(e){this.coreNode.mountY=e}get pivot(){return this.coreNode.pivot}set pivot(e){this.coreNode.pivot=e}get pivotX(){return this.coreNode.pivotX}set pivotX(e){this.coreNode.pivotX=e}get pivotY(){return this.coreNode.pivotY}set pivotY(e){this.coreNode.pivotY=e}get rotation(){return this.coreNode.rotation}set rotation(e){this.coreNode.rotation=e}get parent(){return this._parent}set parent(e){var s;const t=this._parent;if(this._parent=e,this.coreNode.parent=(s=e==null?void 0:e.coreNode)!=null?s:null,t){const o=t.children.indexOf(this);M(o!==-1,"MainOnlyNode.parent: Node not found in old parent's children!"),t.children.splice(o,1)}e&&e.children.push(this)}get children(){return this._children}get zIndex(){return this.coreNode.zIndex}set zIndex(e){this.coreNode.zIndex=e}get zIndexLocked(){return this.coreNode.zIndexLocked}set zIndexLocked(e){this.coreNode.zIndexLocked=e}get src(){return this._src}set src(e){if(this._src!==e){if(this._src=e,!e){this.texture=null;return}this.texture=this.rendererMain.createTexture("ImageTexture",{src:e})}}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this.rendererMain.textureTracker.decrementTextureRefCount(this._texture),e&&this.rendererMain.textureTracker.incrementTextureRefCount(e),this._texture=e,e?this.coreNode.loadTexture(e.txType,e.props,e.options):this.coreNode.unloadTexture())}get rtt(){return this.coreNode.rtt}set rtt(e){e&&(this.texture=this.rendererMain.createTexture("RenderTexture",{width:this.width,height:this.height},{preload:!0,flipY:!0})),this.coreNode.rtt=e}get parentHasRenderTexture(){return this.coreNode.parentHasRenderTexture}get shader(){return this._shader}set shader(e){this._shader!==e&&(this._shader=e,e&&this.coreNode.loadShader(e.shType,e.props))}get data(){return this._data}set data(e){this._data=ki(e)}destroy(){this.emit("beforeDestroy",{});let e=this.children[0];for(;e;)e.destroy(),e=this.children[0];this.coreNode.destroy(),this.parent=null,this.texture=null,this.emit("afterDestroy",{}),this.removeAllListeners()}flush(){}animate(e,t){const s=new Ws(this.coreNode,e,t);return new Us(this.stage.animationManager,s)}}const Vs=r=>{let i=!1;const e=()=>{if(r.updateAnimations(),!r.hasSceneUpdates()){r.calculateFps(),setTimeout(e,16.666666666666668),i||(r.emit("idle"),i=!0);return}i=!1,r.drawFrame(),requestAnimationFrame(e)};requestAnimationFrame(e)},js=()=>performance?performance.now():Date.now();class Gs{constructor(){a(this,"activeAnimations",new Set)}registerAnimation(i){this.activeAnimations.add(i)}unregisterAnimation(i){this.activeAnimations.delete(i)}update(i){this.activeAnimations.forEach(e=>{e.update(i)})}}class Ks{constructor(i){a(this,"imageWorkersEnabled",!0);a(this,"messageManager",{});a(this,"workers",[]);a(this,"workerIndex",0);a(this,"nextId",0);this.workers=this.createWorkers(i),this.workers.forEach(e=>{e.onmessage=this.handleMessage.bind(this)})}handleMessage(i){const{id:e,data:t,error:s}=i.data,o=this.messageManager[e];if(o){const[n,l]=o;delete this.messageManager[e],s?l(new Error(s)):n(t)}}createWorkers(i=1){const e="\n      function hasAlphaChannel(mimeType) {\n          return (mimeType.indexOf(\"image/png\") !== -1);\n      }\n\n      function getImage(src, premultiplyAlpha) {\n        return new Promise(function(resolve, reject) {\n          var xhr = new XMLHttpRequest();\n          xhr.open('GET', src, true);\n          xhr.responseType = 'blob';\n\n          xhr.onload = function() {\n            if (xhr.status === 200) {\n              var blob = xhr.response;\n              var hasAlphaChannel = premultiplyAlpha !== undefined ? premultiplyAlpha : hasAlphaChannel(blob.type);\n\n              createImageBitmap(blob, {\n                premultiplyAlpha: hasAlphaChannel ? 'premultiply' : 'none',\n                colorSpaceConversion: 'none',\n                imageOrientation: 'none'\n              }).then(function(data) {\n                resolve({ data: data, premultiplyAlpha: premultiplyAlpha });\n              }).catch(function(error) {\n                reject(error);\n              });\n            } else {\n              reject(new Error('Failed to load image: ' + xhr.statusText));\n            }\n          };\n\n          xhr.onerror = function() {\n            reject(new Error('Network error occurred while trying to fetch the image.'));\n          };\n\n          xhr.send();\n        });\n      }\n\n      self.onmessage = (event) => {\n        var id = event.data.id;\n        var src = event.data.src;\n        var premultiplyAlpha = event.data.premultiplyAlpha;\n\n        getImage(src, premultiplyAlpha)\n          .then(function(data) {\n              self.postMessage({ id: id, data: data }, [data.data]);\n          })\n          .catch(function(error) {\n              self.postMessage({ id: id, error: error.message });\n          });\n      };\n    ",t=new Blob([e.replace('"use strict";',"")],{type:"application/javascript"}),s=(self.URL?URL:webkitURL).createObjectURL(t),o=[];for(let n=0;n<i;n++)o.push(new Worker(s));return o}getNextWorker(){const i=this.workers[this.workerIndex];return this.workerIndex=(this.workerIndex+1)%this.workers.length,i}convertUrlToAbsolute(i){return new URL(i,self.location.href).href}getImage(i,e){return new Promise((t,s)=>{try{if(this.workers){const o=this.convertUrlToAbsolute(i),n=this.nextId++;this.messageManager[n]=[t,s],this.getNextWorker().postMessage({id:n,src:o,premultiplyAlpha:e})}}catch(o){s(o)}})}}const Ke=class Ke extends ai{constructor(e,t){super(e);a(this,"props");this.props=Ke.resolveDefaults(t)}async getTextureData(){const{width:e,height:t}=this.props,s=e*t*4,o=new Uint8ClampedArray(s);for(let n=0;n<s;n+=4){const l=Math.floor(Math.random()*256);o[n]=l,o[n+1]=l,o[n+2]=l,o[n+3]=255}return{data:new ImageData(o,e,t)}}static makeCacheKey(e){const t=Ke.resolveDefaults(e);return"NoiseTexture,".concat(t.width,",").concat(t.height,",").concat(t.cacheId)}static resolveDefaults(e){var t,s,o;return{width:(t=e.width)!=null?t:128,height:(s=e.height)!=null?s:128,cacheId:(o=e.cacheId)!=null?o:0}}};a(Ke,"z$__type__Props");let Dt=Ke;class qs{constructor(i){a(this,"usedMemory",0);a(this,"txConstructors",{});a(this,"textureKeyCache",new Map);a(this,"textureIdCache",new Map);a(this,"ctxTextureCache",new WeakMap);a(this,"textureRefCountMap",new WeakMap);a(this,"imageWorkerManager",null);a(this,"hasCreateImageBitmap",!!self.createImageBitmap);a(this,"hasWorker",!!self.Worker);a(this,"renderer");this.hasCreateImageBitmap&&this.hasWorker&&(this.imageWorkerManager=new Ks(i)),this.hasCreateImageBitmap||console.warn("[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower."),this.registerTextureType("ImageTexture",Et),this.registerTextureType("ColorTexture",ji),this.registerTextureType("NoiseTexture",Dt),this.registerTextureType("SubTexture",di),this.registerTextureType("RenderTexture",Gi)}registerTextureType(i,e){this.txConstructors[i]=e}loadTexture(i,e,t=null){var n;const s=this.txConstructors[i];if(!s)throw new Error('Texture type "'.concat(i,'" is not registered'));let o;if((t==null?void 0:t.id)!==void 0&&this.textureIdCache.has(t.id)&&(o=this.textureIdCache.get(t.id)),!o){const l=t==null?void 0:t.id,h=(n=t==null?void 0:t.cacheKey)!=null?n:s.makeCacheKey(e);h&&this.textureKeyCache.has(h)?o=this.textureKeyCache.get(h):o=new s(this,e),l&&this.addTextureIdToCache(l,h,o)}return t!=null&&t.preload&&this.getCtxTexture(o).load(),o}addTextureIdToCache(i,e,t){const{textureIdCache:s,textureRefCountMap:o}=this;s.set(i,t),o.has(t)?o.get(t).count++:(o.set(t,{cacheKey:e,count:1}),e&&this.textureKeyCache.set(e,t))}removeTextureIdFromCache(i){var o;const{textureIdCache:e,textureRefCountMap:t}=this,s=e.get(i);if(s){if(e.delete(i),t.has(s)){const n=t.get(s);M(n),n.count--,n.count===0&&(t.delete(s),n.cacheKey&&this.textureKeyCache.delete(n.cacheKey))}(o=this.ctxTextureCache.get(s))==null||o.free()}}getDebugInfo(){return{keyCacheSize:this.textureKeyCache.size,idCacheSize:this.textureIdCache.size}}getCtxTexture(i){if(this.ctxTextureCache.has(i))return this.ctxTextureCache.get(i);const e=this.renderer.createCtxTexture(i);return this.ctxTextureCache.set(i,e),e}}class Qs{constructor(){a(this,"data",{})}reset(){this.data={}}increment(i){this.data[i]||(this.data[i]=0),this.data[i]++}getData(){return{...this.data}}}class Zs{constructor(i){a(this,"memUsed",0);a(this,"textures",new Map);a(this,"threshold");a(this,"gcRequested",!1);this.threshold=i,i===0&&(this.setTextureMemUse=()=>{})}setTextureMemUse(i,e){if(this.textures.has(i)&&(this.memUsed-=this.textures.get(i)),e===0){this.textures.delete(i);return}else this.memUsed+=e,this.textures.set(i,e);this.memUsed>this.threshold&&(this.gcRequested=!0)}gc(){this.gcRequested=!1,this.textures.forEach((i,e)=>{e.renderable||e.free()})}}const Js={isWhite:!0,a:1,r:255,g:255,b:255};function kt(r){if(r===4294967295)return Js;const i=(r>>>24&255)/255,e=r>>>16&255&255,t=r>>>8&255&255,s=r&255&255;return{isWhite:!1,a:i,r:s,g:t,b:e}}function pt({a:r,r:i,g:e,b:t}){return"rgba(".concat(i,",").concat(e,",").concat(t,",").concat(r,")")}class er extends Ki{constructor(){super(...arguments);a(this,"image");a(this,"tintCache")}load(){this.textureSource.state==="freed"&&(this.textureSource.setState("loading"),this.onLoadRequest().then(e=>{this.textureSource.setState("loaded",e),this.updateMemSize()}).catch(e=>{this.textureSource.setState("failed",e)}))}free(){this.image=void 0,this.tintCache=void 0,this.textureSource.setState("freed"),this.memManager.setTextureMemUse(this,0)}updateMemSize(){const e=this.tintCache?8:4;if(this.textureSource.dimensions){const{width:t,height:s}=this.textureSource.dimensions;this.memManager.setTextureMemUse(this,t*s*e)}}hasImage(){return this.image!==void 0}getImage(e){var n;const t=this.image;if(M(t,"Attempt to get unloaded image texture"),e.isWhite)return this.tintCache&&(this.tintCache=void 0,this.updateMemSize()),t;const s=pt(e);if(((n=this.tintCache)==null?void 0:n.key)===s)return this.tintCache.image;const o=this.tintTexture(t,s);return this.tintCache={key:s,image:o},this.updateMemSize(),o}tintTexture(e,t){const{width:s,height:o}=e,n=document.createElement("canvas");n.width=s,n.height=o;const l=n.getContext("2d");return l&&(l.fillStyle=t,l.globalCompositeOperation="copy",l.fillRect(0,0,s,o),l.globalCompositeOperation="multiply",l.drawImage(e,0,0,s,o,0,0,s,o),l.globalCompositeOperation="destination-in",l.drawImage(e,0,0,s,o,0,0,s,o)),n}get renderable(){return this.textureSource.renderable}async onLoadRequest(){const{data:e}=await this.textureSource.getTextureData();if(e instanceof ImageData){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const s=t.getContext("2d");return s&&s.putImageData(e,0,0),this.image=t,{width:e.width,height:e.height}}else if(e instanceof ImageBitmap)return this.image=e,{width:e.width,height:e.height};return{width:0,height:0}}}function tr(r){var i,e;return r.shader instanceof xi&&r.shader.shType===mi&&(e=(i=r.shaderProps)==null?void 0:i.radius)!=null?e:0}class ir extends qi{constructor(e){super(e);a(this,"context");a(this,"canvas");a(this,"pixelRatio");a(this,"clearColor");a(this,"renderToTextureActive",!1);a(this,"activeRttNode",null);this.mode="canvas",this.shManager.renderer=this;const{canvas:t,pixelRatio:s,clearColor:o}=e;this.canvas=t,this.context=t.getContext("2d"),this.pixelRatio=s,this.clearColor=o?Qi(o):void 0}reset(){this.canvas.width=this.canvas.width;const e=this.context;if(this.clearColor){const[t,s,o,n]=this.clearColor;e.fillStyle="rgba(".concat(t,", ").concat(s,", ").concat(o,", ").concat(n/255,")"),e.fillRect(0,0,this.canvas.width,this.canvas.height)}e.scale(this.pixelRatio,this.pixelRatio)}render(){}addQuad(e){const t=this.context,{tx:s,ty:o,width:n,height:l,alpha:h,colorTl:d,colorTr:f,colorBr:u,ta:y,tb:x,tc:w,td:_,clippingRect:m}=e;let R=e.texture,g,p;if(R){if(R instanceof di&&(p=R.props,R=R.parentTexture),g=this.txManager.getCtxTexture(R),R.state==="freed"){g.load();return}if(R.state!=="loaded"||!g.hasImage())return}const c=kt(d),v=y!==1,I=m.width!==0&&m.height!==0,b=d!==f||d!==u,S=e.shader?tr(e):0;if((v||I||S)&&t.save(),I){const T=new Path2D,{x:k,y:L,width:A,height:F}=m;T.rect(k,L,A,F),t.clip(T)}if(v){const T=this.pixelRatio;t.setTransform(y,w,x,_,s*T,o*T),t.scale(T,T),t.translate(-s,-o)}if(S){const T=new Path2D;T.roundRect(s,o,n,l,S),t.clip(T)}if(g){const T=g.getImage(c);t.globalAlpha=h,p?t.drawImage(T,p.x,p.y,p.width,p.height,s,o,n,l):t.drawImage(T,s,o,n,l),t.globalAlpha=1}else if(b){let T=s,k=o,L;d===f?(T=s,k=o+l,L=kt(u)):(T=s+n,k=o,L=kt(f));const A=t.createLinearGradient(s,o,T,k);A.addColorStop(0,pt(c)),A.addColorStop(1,pt(L)),t.fillStyle=A,t.fillRect(s,o,n,l)}else t.fillStyle=pt(c),t.fillRect(s,o,n,l);(v||I||S)&&t.restore()}createCtxTexture(e){return new er(this.txMemManager,e)}getShaderManager(){return this.shManager}renderRTTNodes(){}removeRTTNode(e){}renderToTexture(e){}}const sr=2e6;class rr extends Re{constructor(e){super();a(this,"options");a(this,"animationManager");a(this,"txManager");a(this,"txMemManager");a(this,"fontManager");a(this,"textRenderers");a(this,"shManager");a(this,"renderer");a(this,"root");a(this,"boundsMargin");a(this,"deltaTime",0);a(this,"lastFrameTime",0);a(this,"currentFrameTime",0);a(this,"fpsNumFrames",0);a(this,"fpsElapsedTime",0);a(this,"renderRequested",!1);a(this,"contextSpy",null);this.options=e;const{canvas:t,clearColor:s,rootId:o,debug:n,appWidth:l,appHeight:h,boundsMargin:d,enableContextSpy:f,numImageWorkers:u,txMemByteThreshold:y,renderMode:x}=e;this.txManager=new qs(u),this.txMemManager=new Zs(y),this.shManager=new os,this.animationManager=new Gs,this.contextSpy=f?new Qs:null;let w=[0,0,0,0];d&&(w=Array.isArray(d)?d:[d,d,d,d]),this.boundsMargin=w,n!=null&&n.monitorTextureCache&&setInterval(()=>{M(this.txManager);const R=this.txManager.getDebugInfo();console.log("Texture ID Cache Size: ",R.idCacheSize),console.log("Texture Key Cache Size: ",R.keyCacheSize)},1e3);const _={stage:this,canvas:t,pixelRatio:e.devicePhysicalPixelRatio*e.deviceLogicalPixelRatio,clearColor:s!=null?s:4278190080,bufferMemory:sr,txManager:this.txManager,txMemManager:this.txMemManager,shManager:this.shManager,contextSpy:this.contextSpy};x==="canvas"?this.renderer=new ir(_):this.renderer=new li(_),Zi(x),this.txManager.renderer=this.renderer,this.textRenderers=x==="webgl"?{canvas:new ei(this),sdf:new Ts(this)}:{canvas:new ei(this)},this.fontManager=new yi(this.textRenderers);const m=new Ut(this,{id:o,x:0,y:0,width:l,height:h,alpha:1,autosize:!1,clipping:!1,color:0,colorTop:0,colorBottom:0,colorLeft:0,colorRight:0,colorTl:0,colorTr:0,colorBl:0,colorBr:0,zIndex:0,zIndexLocked:0,scaleX:1,scaleY:1,mountX:0,mountY:0,mount:0,pivot:.5,pivotX:.5,pivotY:.5,rotation:0,parent:null,texture:null,textureOptions:null,shader:null,shaderProps:null,rtt:!1});this.root=m,Vs(this)}updateAnimations(){const{animationManager:e}=this;this.root&&(this.lastFrameTime=this.currentFrameTime,this.currentFrameTime=js(),this.deltaTime=this.lastFrameTime?this.currentFrameTime-this.lastFrameTime:100/6,this.emit("frameTick",{time:this.currentFrameTime,delta:this.deltaTime}),e.update(this.deltaTime))}hasSceneUpdates(){return!!this.root.updateType||this.renderRequested}drawFrame(){const{renderer:e,renderRequested:t}=this;M(e),this.root.updateType!==0&&this.root.update(this.deltaTime,this.root.clippingRect),e.reset(),e.txMemManager.gcRequested&&e.txMemManager.gc(),e.rttNodes.length>0&&e.renderRTTNodes(),this.addQuads(this.root),e==null||e.render(),this.calculateFps(),t&&(this.renderRequested=!1)}calculateFps(){var t,s,o;const{fpsUpdateInterval:e}=this.options;if(e&&(this.fpsNumFrames++,this.fpsElapsedTime+=this.deltaTime,this.fpsElapsedTime>=e)){const n=Math.round(this.fpsNumFrames*1e3/this.fpsElapsedTime);this.fpsNumFrames=0,this.fpsElapsedTime=0,this.emit("fpsUpdate",{fps:n,contextSpyData:(s=(t=this.contextSpy)==null?void 0:t.getData())!=null?s:null}),(o=this.contextSpy)==null||o.reset()}}addQuads(e){M(this.renderer&&e.globalTransform),e.isRenderable&&e.renderQuads(this.renderer);for(let t=0;t<e.children.length;t++){const s=e.children[t];s&&(s==null?void 0:s.worldAlpha)!==0&&this.addQuads(s)}}requestRender(){this.renderRequested=!0}resolveTextRenderer(e,t=null){let s=t,o=!1;if(s){const l=this.textRenderers[s];l?l.canRenderFont(e)||(console.warn("Cannot use override text renderer '".concat(s,"' for font"),e),s=null,o=!0):(console.warn("Text renderer override '".concat(s,"' not found.")),s=null,o=!0)}if(!s){for(const[l,h]of Object.entries(this.textRenderers))if(l!=="canvas"&&h.canRenderFont(e)){s=l;break}s||(s="canvas")}o&&console.warn("Falling back to text renderer ".concat(String(s)));const n=this.textRenderers[s];return M(n,"resolvedTextRenderer undefined"),n}}class or extends Ut{constructor(e,t){super(e,t);a(this,"textRenderer");a(this,"trState");a(this,"_textRendererOverride",null);a(this,"onTextLoaded",()=>{const{contain:e}=this,t=this.trState.props.width,s=this.trState.props.height,o=this.trState.textW||0,n=this.trState.textH||0;e==="both"?(this.props.width=t,this.props.height=s):e==="width"?(this.props.width=t,this.props.height=n):e==="none"&&(this.props.width=o,this.props.height=n),this.updateLocalTransform(),this.stage.requestRender(),this.emit("loaded",{type:"text",dimensions:{width:this.trState.textW||0,height:this.trState.textH||0}})});a(this,"onTextFailed",(e,t)=>{this.emit("failed",{type:"text",error:t})});this._textRendererOverride=t.textRendererOverride;const{resolvedTextRenderer:s,textRendererState:o}=this.resolveTextRendererAndState({x:this.absX,y:this.absY,width:t.width,height:t.height,textAlign:t.textAlign,color:t.color,zIndex:t.zIndex,contain:t.contain,scrollable:t.scrollable,scrollY:t.scrollY,offsetY:t.offsetY,letterSpacing:t.letterSpacing,debug:t.debug,fontFamily:t.fontFamily,fontSize:t.fontSize,fontStretch:t.fontStretch,fontStyle:t.fontStyle,fontWeight:t.fontWeight,text:t.text,lineHeight:t.lineHeight,maxLines:t.maxLines,textBaseline:t.textBaseline,verticalAlign:t.verticalAlign,overflowSuffix:t.overflowSuffix});this.textRenderer=s,this.trState=o}get width(){return this.props.width}set width(e){this.props.width=e,this.textRenderer.set.width(this.trState,e),this.contain==="none"&&this.setUpdateType(C.Local)}get height(){return this.props.height}set height(e){this.props.height=e,this.textRenderer.set.height(this.trState,e),this.contain!=="both"&&this.setUpdateType(C.Local)}get color(){return this.trState.props.color}set color(e){this.textRenderer.set.color(this.trState,e)}get text(){return this.trState.props.text}set text(e){this.textRenderer.set.text(this.trState,e)}get textRendererOverride(){return this._textRendererOverride}set textRendererOverride(e){this._textRendererOverride=e,this.textRenderer.destroyState(this.trState);const{resolvedTextRenderer:t,textRendererState:s}=this.resolveTextRendererAndState(this.trState.props);this.textRenderer=t,this.trState=s}get fontSize(){return this.trState.props.fontSize}set fontSize(e){this.textRenderer.set.fontSize(this.trState,e)}get fontFamily(){return this.trState.props.fontFamily}set fontFamily(e){this.textRenderer.set.fontFamily(this.trState,e)}get fontStretch(){return this.trState.props.fontStretch}set fontStretch(e){this.textRenderer.set.fontStretch(this.trState,e)}get fontStyle(){return this.trState.props.fontStyle}set fontStyle(e){this.textRenderer.set.fontStyle(this.trState,e)}get fontWeight(){return this.trState.props.fontWeight}set fontWeight(e){this.textRenderer.set.fontWeight(this.trState,e)}get textAlign(){return this.trState.props.textAlign}set textAlign(e){this.textRenderer.set.textAlign(this.trState,e)}get contain(){return this.trState.props.contain}set contain(e){this.textRenderer.set.contain(this.trState,e)}get scrollable(){return this.trState.props.scrollable}set scrollable(e){this.textRenderer.set.scrollable(this.trState,e)}get scrollY(){return this.trState.props.scrollY}set scrollY(e){this.textRenderer.set.scrollY(this.trState,e)}get offsetY(){return this.trState.props.offsetY}set offsetY(e){this.textRenderer.set.offsetY(this.trState,e)}get letterSpacing(){return this.trState.props.letterSpacing}set letterSpacing(e){this.textRenderer.set.letterSpacing(this.trState,e)}get lineHeight(){return this.trState.props.lineHeight}set lineHeight(e){this.textRenderer.set.lineHeight&&this.textRenderer.set.lineHeight(this.trState,e)}get maxLines(){return this.trState.props.maxLines}set maxLines(e){this.textRenderer.set.maxLines&&this.textRenderer.set.maxLines(this.trState,e)}get textBaseline(){return this.trState.props.textBaseline}set textBaseline(e){this.textRenderer.set.textBaseline&&this.textRenderer.set.textBaseline(this.trState,e)}get verticalAlign(){return this.trState.props.verticalAlign}set verticalAlign(e){this.textRenderer.set.verticalAlign&&this.textRenderer.set.verticalAlign(this.trState,e)}get overflowSuffix(){return this.trState.props.overflowSuffix}set overflowSuffix(e){this.textRenderer.set.overflowSuffix&&this.textRenderer.set.overflowSuffix(this.trState,e)}get debug(){return this.trState.props.debug}set debug(e){this.textRenderer.set.debug(this.trState,e)}update(e,t){super.update(e,t),M(this.globalTransform),this.textRenderer.set.x(this.trState,this.globalTransform.tx),this.textRenderer.set.y(this.trState,this.globalTransform.ty)}checkRenderProps(){return this.trState.props.text!==""?!0:super.checkRenderProps()}onChangeIsRenderable(e){super.onChangeIsRenderable(e),this.textRenderer.setIsRenderable(this.trState,e)}renderQuads(e){var t;M(this.globalTransform),!(this.parentHasRenderTexture&&(!e.renderToTextureActive||this.parentRenderTexture!==e.activeRttNode))&&(this.parentHasRenderTexture&&((t=this.props.parent)!=null&&t.rtt)&&(this.globalTransform=q.identity(),this.localTransform&&this.globalTransform.multiply(this.localTransform)),M(this.globalTransform),this.textRenderer.renderQuads(this.trState,this.globalTransform,this.clippingRect,this.worldAlpha,this.parentHasRenderTexture,this.framebufferDimensions))}destroy(){super.destroy(),this.textRenderer.destroyState(this.trState)}resolveTextRendererAndState(e){const t=this.stage.resolveTextRenderer(e,this._textRendererOverride),s=t.createState(e);return s.emitter.on("loaded",this.onTextLoaded),s.emitter.on("failed",this.onTextFailed),t.scheduleUpdateState(s),{resolvedTextRenderer:t,textRendererState:s}}}class nr extends $t{constructor(i,e,t){super(i,e,t,new or(t,{id:Ht(),x:i.x,y:i.y,width:i.width,height:i.height,alpha:i.alpha,autosize:i.autosize,clipping:i.clipping,color:i.color,colorTop:i.colorTop,colorBottom:i.colorBottom,colorLeft:i.colorLeft,colorRight:i.colorRight,colorTl:i.colorTl,colorTr:i.colorTr,colorBl:i.colorBl,colorBr:i.colorBr,zIndex:i.zIndex,zIndexLocked:i.zIndexLocked,scaleX:i.scaleX,scaleY:i.scaleY,mountX:i.mountX,mountY:i.mountY,mount:i.mount,pivot:i.pivot,pivotX:i.pivotX,pivotY:i.pivotY,rotation:i.rotation,text:i.text,fontSize:i.fontSize,fontFamily:i.fontFamily,fontWeight:i.fontWeight,fontStretch:i.fontStretch,fontStyle:i.fontStyle,contain:i.contain,scrollable:i.scrollable,letterSpacing:i.letterSpacing,textAlign:i.textAlign,scrollY:i.scrollY,offsetY:i.offsetY,textRendererOverride:i.textRendererOverride,lineHeight:i.lineHeight,maxLines:i.maxLines,textBaseline:i.textBaseline,verticalAlign:i.verticalAlign,overflowSuffix:i.overflowSuffix,debug:i.debug,parent:null,texture:null,textureOptions:null,shader:null,shaderProps:null,rtt:!1}))}get text(){return this.coreNode.text}set text(i){this.coreNode.text=i}get textRendererOverride(){return this.coreNode.textRendererOverride}set textRendererOverride(i){this.coreNode.textRendererOverride=i}get fontSize(){return this.coreNode.fontSize}set fontSize(i){this.coreNode.fontSize=i}get fontFamily(){return this.coreNode.fontFamily}set fontFamily(i){this.coreNode.fontFamily=i}get fontWeight(){return this.coreNode.fontWeight}set fontWeight(i){this.coreNode.fontWeight=i}get fontStretch(){return this.coreNode.fontStretch}set fontStretch(i){this.coreNode.fontStretch=i}get fontStyle(){return this.coreNode.fontStyle}set fontStyle(i){this.coreNode.fontStyle=i}get textAlign(){return this.coreNode.textAlign}set textAlign(i){this.coreNode.textAlign=i}get contain(){return this.coreNode.contain}set contain(i){this.coreNode.contain=i}get scrollable(){return this.coreNode.scrollable}set scrollable(i){this.coreNode.scrollable=i}get scrollY(){return this.coreNode.scrollY}set scrollY(i){this.coreNode.scrollY=i}get offsetY(){return this.coreNode.offsetY}set offsetY(i){this.coreNode.offsetY=i}get letterSpacing(){return this.coreNode.letterSpacing}set letterSpacing(i){this.coreNode.letterSpacing=i}get lineHeight(){return this.coreNode.lineHeight}set lineHeight(i){i&&(this.coreNode.lineHeight=i)}get maxLines(){return this.coreNode.maxLines}set maxLines(i){i&&(this.coreNode.maxLines=i)}get textBaseline(){return this.coreNode.textBaseline}set textBaseline(i){i&&(this.coreNode.textBaseline=i)}get verticalAlign(){return this.coreNode.verticalAlign}set verticalAlign(i){i&&(this.coreNode.verticalAlign=i)}get overflowSuffix(){return this.coreNode.overflowSuffix}set overflowSuffix(i){i&&(this.coreNode.overflowSuffix=i)}get debug(){return this.coreNode.debug}set debug(i){this.coreNode.debug=i}}class ar{constructor(){a(this,"root",null);a(this,"stage",null);a(this,"rendererMain",null)}async init(i,e,t){this.stage=new rr({rootId:Ht(),appWidth:e.appWidth,appHeight:e.appHeight,txMemByteThreshold:e.txMemByteThreshold,boundsMargin:e.boundsMargin,deviceLogicalPixelRatio:e.deviceLogicalPixelRatio,devicePhysicalPixelRatio:e.devicePhysicalPixelRatio,clearColor:e.clearColor,canvas:t,fpsUpdateInterval:e.fpsUpdateInterval,enableContextSpy:e.enableContextSpy,numImageWorkers:e.numImageWorkers,renderMode:e.renderMode,debug:{monitorTextureCache:!1}}),this.rendererMain=i,M(this.stage.root);const s=new $t(i.resolveNodeDefaults({}),this.rendererMain,this.stage,this.stage.root);this.root=s,s.once("beforeDestroy",this.onBeforeDestroyNode.bind(this,s)),this.onCreateNode(s),e.coreExtensionModule&&await Ds(e.coreExtensionModule,this.stage),this.stage.on("fpsUpdate",(o,n)=>{this.onFpsUpdate(n)}),this.stage.on("frameTick",(o,n)=>{this.onFrameTick(n)}),this.stage.on("idle",()=>{this.onIdle()})}createNode(i){M(this.rendererMain),M(this.stage);const e=new $t(i,this.rendererMain,this.stage);return e.once("beforeDestroy",this.onBeforeDestroyNode.bind(this,e)),this.onCreateNode(e),e}createTextNode(i){M(this.rendererMain),M(this.stage);const e=new nr(i,this.rendererMain,this.stage);return e.once("beforeDestroy",this.onBeforeDestroyNode.bind(this,e)),this.onCreateNode(e),e}destroyNode(i){i.destroy()}releaseTexture(i){const{stage:e}=this;M(e),e.txManager.removeTextureIdFromCache(i)}getRootNode(){return M(this.root),this.root}onCreateNode(i){throw new Error("Method not implemented.")}onBeforeDestroyNode(i){throw new Error("Method not implemented.")}onFpsUpdate(i){throw new Error("Method not implemented.")}onFrameTick(i){throw new Error("Method not implemented.")}onIdle(){throw new Error("Method not implemented.")}}let Pe,Xt;function lr(r={},i="app"){const e=new ar;return Pe=new Ys(r,i,e),Xt=Pe.createShader.bind(Pe),Pe}class hr extends Array{constructor(i){super(),this._parent=i}get selected(){return this[this._parent.selected||0]}get firstChild(){return this[0]}insert(i,e){if(e){const t=this.indexOf(e);this.splice(t,0,i)}else this.push(i);i.parent=this._parent}remove(i){const e=this.indexOf(i);e>=0&&this.splice(e,1)}}function cr(){return{BASE_URL:"./",DEV:!1,LEGACY:!1,MODE:"production",PROD:!0,SSR:!1,STORYBOOK:"true"}&&!1}const dr=cr()||!1,je={debug:!1,animationsEnabled:!0,animationSettings:{duration:250,easing:"ease-in-out"},fontSettings:{fontFamily:"Ubuntu",fontSize:100}};function si(r){return ur(r)&&r.debug}function be(r,i,...e){dr&&(si(i)||si(e[0]))&&console.log(r,i,...e)}function dt(r){return typeof r=="function"}function ur(r){return typeof r=="object"}function wt(r){return Array.isArray(r)}function fr(r){return typeof r=="string"}function pr(r){return typeof r=="number"}function gr(r,i){for(const e of i)if(e in r)return!0;return!1}function Ni(r,i={}){if(wt(r))r.forEach(e=>{Ni(e,i)});else if(r)for(const e in r)i[e]===void 0&&(i[e]=r[e]);return i}class ri extends Array{constructor(i,e={}){return wt(e)?super(...e):fr(e)?super(e):super(...Object.entries(e).filter(([t,s])=>s).map(([t])=>t)),this.onChange=i,this}has(i){return this.indexOf(i)>=0}is(i){return this.indexOf(i)>=0}add(i){this.push(i),this.onChange()}toggle(i){this.has(i)?this.remove(i):this.add(i)}remove(i){const e=this.indexOf(i);e>=0&&(this.splice(e,1),this.onChange())}}function mr(r){const i=[];let e=!1;for(let p=0;p<r.children.length;p++){const c=r.children[p];if(c.name!=="TextNode"&&c.flexItem!==!1){if(c.name==="text"&&c.text!==""&&!(c.width||c.height))return!1;c.flexOrder!==void 0&&(e=!0),i.push(c)}}e&&i.sort((p,c)=>(p.flexOrder||0)-(c.flexOrder||0));const t=i.length,o=(r.flexDirection||"row")==="row",n=o?"width":"height",l=o?"height":"width",h=o?"marginLeft":"marginTop",d=o?"marginRight":"marginBottom",f=o?"x":"y",u=o?"y":"x",y=r[n]||0,x=r[l]||0,w=r.gap||0,_=r.justifyContent||"flexStart",m=r.alignItems;let R=0;["center","spaceBetween","spaceEvenly"].includes(_)&&(R=i.reduce((p,c)=>p+(c[n]||0),0));const g=x&&m?p=>{m==="flexStart"?p[u]=0:m==="center"?p[u]=(x-(p[l]||0))/2:m==="flexEnd"&&(p[u]=x-(p[l]||0))}:p=>p;if(_==="flexStart"){let p=0;if(i.forEach(c=>{c[f]=p+(c[h]||0),p+=(c[n]||0)+w+(c[h]||0)+(c[d]||0),g(c)}),r.flexBoundary!=="fixed"){const c=p-w;if(c!==r[n])return r[n]=c,!0}}else if(_==="flexEnd"){let p=y;for(let c=t-1;c>=0;c--){const v=i[c];M(v),v[f]=p-(v[n]||0)-(v[d]||0),p-=(v[n]||0)+w+(v[h]||0)+(v[d]||0),g(v)}}else if(_==="center"){let p=(y-(R+w*(t-1)))/2;i.forEach(c=>{c[f]=p,p+=(c[n]||0)+w,g(c)})}else if(_==="spaceBetween"){const p=(y-R)/(t-1);let c=0;i.forEach(v=>{v[f]=c,c+=(v[n]||0)+p,g(v)})}else if(_==="spaceEvenly"){const p=(y-R)/(t+1);let c=p;i.forEach(v=>{v[f]=c,c+=(v[n]||0)+p,g(v)})}return!1}const{animationSettings:xr}=je,ut=[];let Nt=!0;function oi(r){const i=[];for(const[e,t]of Object.entries(r))i.push({type:e,props:t});return Xt("DynamicShader",{effects:i})}function Ye(r=""){return{set(i){pr(i)&&(i={width:i,color:255}),this.effects={...this.effects||{},["border".concat(r)]:i},this["_border".concat(r)]=i},get(){return this["_border".concat(r)]}}}const yr=["alpha","color","colorTop","colorRight","colorLeft","colorBottom","colorTl","colorTr","colorBl","colorBr","height","fontSize","lineHeight","mount","mountX","mountY","pivot","pivotX","pivotY","rotation","scale","width","worldX","worldY","x","y","zIndex","zIndexLocked"],vr=["autosize","clipping","contain","fontFamily","fontStretch","fontStyle","fontWeight","letterSpacing","maxLines","offsetY","overflowSuffix","rtt","scrollable","scrollY","src","text","textAlign","textBaseline","textOverflow","texture","verticalAlign","wordWrap"];class ne extends Object{constructor(i){super(),this._animationQueue=[],this._animationRunning=!1,this.name=i,this._renderProps={},this.children=new hr(this)}get effects(){return this._effects}set effects(i){this._effects=i,this.lng&&(this.shader=oi(i))}get parent(){return this._parent}set parent(i){var e;this._parent=i,this.lng&&(this.lng.parent=(e=i==null?void 0:i.lng)!=null?e:null)}get shader(){return this._shader}set shader(i){wt(i)?this._shader=Xt(...i):this._shader=i,this._sendToLightning("shader",this._shader)}_sendToLightningAnimatable(i,e){if(this.lng){if(this.transition&&(this.transition===!0||this.transition[i])){const t=this.transition===!0||this.transition[i]===!0?void 0:this.transition[i];return this.animate({[i]:e},t).start()}this.lng[i]=e}else this._renderProps[i]=e}_sendToLightning(i,e){this.lng?this.lng[i]=e:this._renderProps[i]=e}animate(i,e){return M(this.lng,"Node must be rendered before animating"),this.lng.animate(i,e||this.animationSettings)}chain(i,e){return this._animationRunning&&(this._animationQueue=[],this._animationRunning=!1),e?this._animationQueueSettings=e:this._animationQueueSettings||(this._animationQueueSettings=e||this.animationSettings),e=e||this._animationQueueSettings,this._animationQueue.push({props:i,animationSettings:e}),this}async start(){let i=this._animationQueue.shift();for(;i;)this._animationRunning=!0,await this.animate(i.props,i.animationSettings).start().waitUntilStopped(),i=this._animationQueue.shift();this._animationRunning=!1,this._animationQueueSettings=void 0}setFocus(){if(this.lng){if(this.forwardFocus!==void 0)if(dt(this.forwardFocus)){if(this.forwardFocus.call(this,this)!==!1)return}else{const i=typeof this.forwardFocus=="number"?this.forwardFocus:null;if(i!==null&&i<this.children.length){const e=this.children[i];e instanceof ne&&e.setFocus();return}}queueMicrotask(()=>Bs(this))}else this.autofocus=!0}isTextNode(){return this.name==="text"}_layoutOnLoad(){this.lng.on("loaded",(i,e)=>{const{dimensions:t}=e;this.parent.updateLayout(this,t)})}getText(){return this.children.map(i=>i.text).join("")}destroy(){var i;this._queueDelete&&((i=this.lng)==null||i.destroy())}set onEvents(i){this._events=i}get onEvents(){return this._events||[]}set style(i){wt(i)?this._style=Ni(i):this._style=i;for(const e in this._style)this[e]===void 0&&(this[e]=this._style[e])}get style(){return this._style}get hasChildren(){return this.children.length>0}getChildById(i){return this.children.find(e=>e.id===i)}searchChildrenById(i){for(let e=0;e<this.children.length;e++){const t=this.children[e];if(t instanceof ne){if(t.id===i)return t;const s=t.searchChildrenById(i);if(s)return s}}}set states(i){this._states=new ri(this._stateChanged.bind(this),i),this.lng&&this._stateChanged()}get states(){return this._states=this._states||new ri(this._stateChanged.bind(this)),this._states}get animationSettings(){return this._animationSettings||xr}set animationSettings(i){this._animationSettings=i}requiresLayout(){return this.display==="flex"||this.onBeforeLayout}updateLayout(i,e){var t,s;if(this.hasChildren){be("Layout: ",this);let o=!1;dt(this.onBeforeLayout)&&(o=this.onBeforeLayout.call(this,this,i,e)),this.display==="flex"?(mr(this)||o)&&((t=this.parent)==null||t.updateLayout()):o&&((s=this.parent)==null||s.updateLayout()),dt(this.onLayout)&&this.onLayout.call(this,this,i,e)}}_stateChanged(){if(be("State Changed: ",this,this.states),this.forwardStates){const e=this.states.slice();this.children.forEach(t=>t.states=e)}const i=this.states;if(this._undoStyles||this.style&&gr(this.style,i)){this._undoStyles=this._undoStyles||[];const e={};this._undoStyles.forEach(s=>{e[s]=this.style[s]});const t=i.reduce((s,o)=>{const n=this.style[o];return n&&(s={...s,...n}),s},{});this._undoStyles=Object.keys(t),t.transition!==void 0&&(this.transition=t.transition),Object.assign(this,e,t)}}render(){const i=this,e=this.parent;if(!e){console.warn("Parent not set - no node created for: ",this);return}if(!e.lng){console.warn("Parent not rendered yet: ",this);return}if(this.lng){console.warn("Node already rendered: ",this);return}e.requiresLayout()&&ut.indexOf(e)===-1&&(ut.push(e),Nt&&(Nt=!1,queueMicrotask(()=>{for(Nt=!0;ut.length;)ut.pop().updateLayout()}))),this.states.length&&this._stateChanged();const t=i._renderProps;if(t.x=t.x||0,t.y=t.y||0,e.lng&&(t.parent=e.lng),i._effects&&(this.shader=oi(i._effects)),i.isTextNode()){if(je.fontSettings)for(const s in je.fontSettings)t[s]===void 0&&(t[s]=je.fontSettings[s]);t.text=i.getText(),t.contain&&(t.width||(t.width=(e.width||0)-t.x-(t.marginRight||0)),t.contain==="both"&&!t.height&&!t.maxLines?t.height=(e.height||0)-t.y-(t.marginBottom||0):t.maxLines===1&&(t.height=t.height||t.lineHeight||t.fontSize)),be("Rendering: ",this,t),i.lng=Pe.createTextNode(t),e.requiresLayout()&&(!t.width||!t.height)&&i._layoutOnLoad()}else t.texture||(isNaN(t.width)&&(t.width=(e.width||0)-t.x),isNaN(t.height)&&(t.height=(e.height||0)-t.y),!t.color&&!t.src&&(t.color=0)),be("Rendering: ",this,t),i.lng=Pe.createNode(t);t.autosize&&e.requiresLayout()&&i._layoutOnLoad(),i.onFail&&i.lng.on("failed",i.onFail),i.onLoad&&i.lng.on("loaded",i.onLoad),dt(this.onCreate)&&this.onCreate.call(this,i),i.onEvents.forEach(([s,o])=>{var n;(n=i.lng)==null||n.on(s,(l,h)=>o(i,h))}),i.lng.div&&(i.lng.div.solid=i),i.name!=="text"&&i.children.forEach(s=>{s.render?s.render():s.text!==""&&console.warn("TextNode outside of <Text>: ",s)}),i.autofocus&&i.setFocus(),this._renderProps={}}}for(const r of yr)Object.defineProperty(ne.prototype,r,{get(){return this.lng?this.lng[r]:this._renderProps[r]},set(i){this._sendToLightningAnimatable(r,i)}});for(const r of vr)Object.defineProperty(ne.prototype,r,{get(){return this.lng?this.lng[r]:this._renderProps[r]},set(i){this._sendToLightning(r,i)}});Object.defineProperties(ne.prototype,{borderRadius:{set(r){this._borderRadius=r,this.effects={...this.effects||{},radius:{radius:r}}},get(){return this._borderRadius}},border:Ye(),borderLeft:Ye("Left"),borderRight:Ye("Right"),borderTop:Ye("Top"),borderBottom:Ye("Bottom")});Object.defineProperties(ne.prototype,{linearGradient:{set(r={}){this._linearGradient=r,this.effects={...this.effects||{},linearGradient:r}},get(){return this._linearGradient}}});function wr({createElement:r,createTextNode:i,isTextNode:e,replaceText:t,insertNode:s,removeNode:o,setProperty:n,getParentNode:l,getFirstChild:h,getNextSibling:d}){function f(g,p,c,v){if(c!==void 0&&!v&&(v=[]),typeof p!="function")return u(g,p,v,c);me(I=>u(g,p(),I,c),v)}function u(g,p,c,v,I){for(;typeof c=="function";)c=c();if(p===c)return c;const b=typeof p,S=v!==void 0;if(b==="string"||b==="number")if(b==="number"&&(p=p.toString()),S){let T=c[0];T&&e(T)?t(T,p):T=i(p),c=w(g,c,v,T)}else c!==""&&typeof c=="string"?t(h(g),c=p):(w(g,c,v,i(p)),c=p);else if(p==null||b==="boolean")c=w(g,c,v);else{if(b==="function")return me(()=>{let T=p();for(;typeof T=="function";)T=T();c=u(g,T,c,v)}),()=>c;if(Array.isArray(p)){const T=[];if(y(T,p,I))return me(()=>c=u(g,T,c,v,!0)),()=>c;if(T.length===0){const k=w(g,c,v);if(S)return c=k}else Array.isArray(c)?c.length===0?_(g,T,v):x(g,c,T):c==null||c===""?_(g,T):x(g,S&&c||[h(g)],T);c=T}else{if(Array.isArray(c)){if(S)return c=w(g,c,v,p);w(g,c,null,p)}else c==null||c===""||!h(g)?s(g,p):m(g,p,h(g));c=p}}return c}function y(g,p,c){let v=!1;for(let I=0,b=p.length;I<b;I++){let S=p[I],T;if(!(S==null||S===!0||S===!1))if(Array.isArray(S))v=y(g,S)||v;else if((T=typeof S)=="string"||T==="number")g.push(i(S));else if(T==="function")if(c){for(;typeof S=="function";)S=S();v=y(g,Array.isArray(S)?S:[S])||v}else g.push(S),v=!0;else g.push(S)}return v}function x(g,p,c){let v=c.length,I=p.length,b=v,S=0,T=0,k=d(p[I-1]),L=null;for(;S<I||T<b;){if(p[S]===c[T]){S++,T++;continue}for(;p[I-1]===c[b-1];)I--,b--;if(I===S){const A=b<v?T?d(c[T-1]):c[b-T]:k;for(;T<b;)s(g,c[T++],A)}else if(b===T)for(;S<I;)(!L||!L.has(p[S]))&&o(g,p[S]),S++;else if(p[S]===c[b-1]&&c[T]===p[I-1]){const A=d(p[--I]);s(g,c[T++],d(p[S++])),s(g,c[--b],A),p[I]=c[b]}else{if(!L){L=new Map;let F=T;for(;F<b;)L.set(c[F],F++)}const A=L.get(p[S]);if(A!=null)if(T<A&&A<b){let F=S,z=1,N;for(;++F<I&&F<b&&!((N=L.get(p[F]))==null||N!==A+z);)z++;if(z>A-T){const B=p[S];for(;T<A;)s(g,c[T++],B)}else m(g,c[T++],p[S++])}else S++;else o(g,p[S++])}}}function w(g,p,c,v){if(c===void 0){let b;for(;b=h(g);)o(g,b);return v&&s(g,v),""}const I=v||i("");if(p.length){let b=!1;for(let S=p.length-1;S>=0;S--){const T=p[S];if(I!==T){const k=l(T)===g;!b&&!S?k?m(g,I,T):s(g,I,c):k&&o(g,T)}else b=!0}}else s(g,I,c);return[I]}function _(g,p,c){for(let v=0,I=p.length;v<I;v++)s(g,p[v],c)}function m(g,p,c){s(g,p,c),o(g,c)}function R(g,p,c={},v){return p||(p={}),v||me(()=>c.children=u(g,p.children,c.children)),me(()=>p.ref&&p.ref(g)),me(()=>{for(const I in p){if(I==="children"||I==="ref")continue;const b=p[I];b!==c[I]&&(n(g,I,b,c[I]),c[I]=b)}}),c}return{render(g,p){let c;return bs(v=>{c=v,f(p,g())}),c},insert:f,spread(g,p,c){typeof p=="function"?me(v=>R(g,p(),v,c)):R(g,p,void 0,c)},createElement:r,createTextNode:i,insertNode:s,setProp(g,p,c,v){return n(g,p,c,v),c},mergeProps:Ii,effect:me,memo:Ti,createComponent:Ns,use(g,p,c){return qe(()=>g(p,c))}}}function Tr(r){const i=wr(r);return i.mergeProps=Ii,i}const Ai={createElement(r){return new ne(r)},createTextNode(r){return{name:"TextNode",text:r,parent:void 0}},replaceText(r,i){be("Replace Text: ",r,i),r.text=i;const e=r.parent;M(e),e.text=e.getText()},setProperty(r,i,e=!0){r[i]=e},insertNode(r,i,e){be("INSERT: ",r,i,e),r.children.insert(i,e),i._queueDelete=!1,i instanceof ne?r.lng&&i.render():r.isTextNode()&&(r.text=r.getText())},isTextNode(r){return r.isTextNode()},removeNode(r,i){be("REMOVE: ",r,i),r.children.remove(i),i._queueDelete=!0,i instanceof ne&&queueMicrotask(()=>i.destroy())},getParentNode(r){return r.parent},getFirstChild(r){return r.children[0]},getNextSibling(r){const i=r.parent.children||[],e=i.indexOf(r)+1;if(e<i.length)return i[e]}},zi=Tr(Ai);let Tt;async function _r(r,i){return Tt=lr(je.rendererOptions,i||"app"),await Tt.init()}const Nr=async function(r,i){const e=Ai.createElement("App");return await _r(void 0,i),e.lng=Tt.root,{dispose:zi.render(r,e),rootNode:e,renderer:Tt}},{effect:Ar,memo:zr,createComponent:Br,createElement:Fr,createTextNode:Pr,insertNode:Er,insert:Or,spread:$r,setProp:Dr,mergeProps:Yr,use:Wr}=zi;export{Lr as D,Br as a,bs as b,Fr as c,Cs as d,Cr as e,Rr as f,Mr as g,kr as h,Yr as m,Ir as o,Nr as r,$r as s,qe as u};
